Source: https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates

[ Skip Navigation ](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates#app-main)
  * [Global Nav Open Menu](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates#ac-gn-menustate)[Global Nav Close Menu](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates)
  * [Apple Developer](https://developer.apple.com/)


[ Search Developer Cancel  ](https://developer.apple.com/search/)
  * [Apple Developer](https://developer.apple.com/)
  * [News](https://developer.apple.com/news/)
  * [Discover](https://developer.apple.com/discover/)
  * [Design](https://developer.apple.com/design/)
  * [Develop](https://developer.apple.com/develop/)
  * [Distribute](https://developer.apple.com/distribute/)
  * [Support](https://developer.apple.com/support/)
  * [Account](https://developer.apple.com/account/)
  * [](https://developer.apple.com/search/)


Cancel 
Only search within “Documentation”
### Quick Links
  * [Downloads](https://developer.apple.com/download/)
  * [Documentation](https://developer.apple.com/documentation/)
  * [Sample Code](https://developer.apple.com/documentation/samplecode/)
  * [Videos](https://developer.apple.com/videos/)
  * [Forums](https://developer.apple.com/forums/)

5 Quick Links
[ Documentation ](https://developer.apple.com/documentation)
[ Open Menu ](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates)
  * SwiftLanguage:  Swift  Objective-C 
Language: 
    * Swift 
    * [ Objective-C ](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates)


[](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates)
## [ Core ML  ](https://developer.apple.com/documentation/coreml)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
3 of 54 symbols inside <root> [Updating a Model File to a Model Package](https://developer.apple.com/documentation/coreml/updating-a-model-file-to-a-model-package)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
4 of 54 symbols inside <root> [Integrating a Core ML Model into Your App](https://developer.apple.com/documentation/coreml/integrating-a-core-ml-model-into-your-app)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
5 of 54 symbols inside <root> containing 32 symbols[MLModel](https://developer.apple.com/documentation/coreml/mlmodel)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
6 of 54 symbols inside <root> containing 7 symbols[Model Customization](https://developer.apple.com/documentation/coreml/model-customization)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
7 of 54 symbols inside <root> containing 4 symbols[Model Personalization](https://developer.apple.com/documentation/coreml/model-personalization)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
1 of 4 symbols inside -1293477552 
On-device model updates
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
2 of 4 symbols inside -1293477552 containing 9 symbols[MLTask](https://developer.apple.com/documentation/coreml/mltask)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
3 of 4 symbols inside -1293477552 [Personalizing a Model with On-Device Updates](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
4 of 4 symbols inside -1293477552 containing 16 symbols[MLUpdateTask](https://developer.apple.com/documentation/coreml/mlupdatetask)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
8 of 54 symbols inside <root>
Model inputs and outputs
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
9 of 54 symbols inside <root> [Making Predictions with a Sequence of Inputs](https://developer.apple.com/documentation/coreml/making-predictions-with-a-sequence-of-inputs)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
10 of 54 symbols inside <root> containing 47 symbols[MLFeatureValue](https://developer.apple.com/documentation/coreml/mlfeaturevalue)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
11 of 54 symbols inside <root> containing 18 symbols[MLSendableFeatureValue](https://developer.apple.com/documentation/coreml/mlsendablefeaturevalue)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
12 of 54 symbols inside <root> containing 3 symbols[MLFeatureProvider](https://developer.apple.com/documentation/coreml/mlfeatureprovider)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
13 of 54 symbols inside <root> containing 5 symbols[MLDictionaryFeatureProvider](https://developer.apple.com/documentation/coreml/mldictionaryfeatureprovider)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
14 of 54 symbols inside <root> containing 3 symbols[MLBatchProvider](https://developer.apple.com/documentation/coreml/mlbatchprovider)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
15 of 54 symbols inside <root> containing 5 symbols[MLArrayBatchProvider](https://developer.apple.com/documentation/coreml/mlarraybatchprovider)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
16 of 54 symbols inside <root> containing 9 symbols[MLModelAsset](https://developer.apple.com/documentation/coreml/mlmodelasset)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
17 of 54 symbols inside <root>
App integration
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
18 of 54 symbols inside <root> [Downloading and Compiling a Model on the User’s Device](https://developer.apple.com/documentation/coreml/downloading-and-compiling-a-model-on-the-user-s-device)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
19 of 54 symbols inside <root> containing 9 symbols[Model Integration Samples](https://developer.apple.com/documentation/coreml/model-integration-samples)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
20 of 54 symbols inside <root>
Model encryption
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
21 of 54 symbols inside <root> [Generating a Model Encryption Key](https://developer.apple.com/documentation/coreml/generating-a-model-encryption-key)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
22 of 54 symbols inside <root> [Encrypting a Model in Your App](https://developer.apple.com/documentation/coreml/encrypting-a-model-in-your-app)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
23 of 54 symbols inside <root>
Compute devices
58 items were found. Tab back to navigate through them. 
/ 
Navigator is ready 
  * [ Core ML ](https://developer.apple.com/documentation/coreml)
  * [ Model Personalization ](https://developer.apple.com/documentation/coreml/model-personalization)
  * [ Personalizing a Model with On-Device Updates ](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates)
  *     * [ Model Personalization ](https://developer.apple.com/documentation/coreml/model-personalization)
    * Personalizing a Model with On-Device Updates 


Sample Code
# Personalizing a Model with On-Device Updates
Modify an updatable Core ML model by running an update task with labeled data.
[ Download ](https://docs-assets.developer.apple.com/published/9a8ff1fea55d/PersonalizingAModelWithOnDeviceUpdates.zip)
iOS 13.0+iPadOS 13.0+Xcode 15.2+
## [Overview](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates#Overview)
With the [Core ML](https://developer.apple.com/documentation/CoreML) framework, you can customize an updatable model at runtime on the user’s device. Using this technique, you can create a personalized experience for the user while keeping their data private.
This sample demonstrates how to update the drawing classifier with an [`MLUpdateTask`](https://developer.apple.com/documentation/CoreML/MLUpdateTask). The app initiates an update task with the user’s drawings paired with a string label. Once the update is complete, the app uses the updated drawing classifier to recognize similar drawings from the user and convert each into its associated string label.
Note
Run this sample on a device or Simulator with iOS 13 or later, or iPadOS 13 or later.
### [Prepare your model update data](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates#Prepare-your-model-update-data)
Gather your training data:
  1. Wrap each value of a datapoint in an [`MLFeatureValue`](https://developer.apple.com/documentation/CoreML/MLFeatureValue), one for each model input and output.
  2. Group all the feature values for a datapoint in an [`MLFeatureProvider`](https://developer.apple.com/documentation/CoreML/MLFeatureProvider).
  3. Group all the feature providers in an [`MLBatchProvider`](https://developer.apple.com/documentation/CoreML/MLBatchProvider).


Each time the user adds a new emoji sticker, the app prompts the user to make three drawings, and uses those drawings to update the drawing classifier. It does this by first creating an [`MLDictionaryFeatureProvider`](https://developer.apple.com/documentation/CoreML/MLDictionaryFeatureProvider) that contains the feature values for a drawing and its label. The app appends each feature provider to an array, which it uses to create an [`MLArrayBatchProvider`](https://developer.apple.com/documentation/CoreML/MLArrayBatchProvider) at the end of the function.
```
 var featureProviders = [MLFeatureProvider]()


 let inputName = "drawing"
 let outputName = "label"
         
 for drawing in trainingDrawings {
     let inputValue = drawing.featureValue
     let outputValue = MLFeatureValue(string: String(emoji))
     
     let dataPointFeatures: [String: MLFeatureValue] = [inputName: inputValue,
                                                        outputName: outputValue]
     
     if let provider = try? MLDictionaryFeatureProvider(dictionary: dataPointFeatures) {
         featureProviders.append(provider)
     }
 }
 
return MLArrayBatchProvider(array: featureProviders)

```

The sample makes each `MLDictionaryFeatureProvider` by initializing it with a dictionary of two [`MLFeatureValue`](https://developer.apple.com/documentation/CoreML/MLFeatureValue) instances keyed by strings. The feature values are:
  * The underlying image of the drawing keyed by `"drawing"`
  * The emoji character as a string keyed by `"label"`


The sample creates a feature value for the emoji string by using [`init(string:)`](https://developer.apple.com/documentation/CoreML/MLFeatureValue/init\(string:\)). However, to convert the drawing’s underlying [`CGImage`](https://developer.apple.com/documentation/CoreGraphics/CGImage) into a feature value, the sample acquires the image constraint of the model’s image input feature.
```
let imageFeatureValue = try? MLFeatureValue(cgImage: preparedImage,
                                            constraint: imageConstraint)
return imageFeatureValue!

```

The sample gets the drawing classifier’s `"drawing"` [`MLImageConstraint`](https://developer.apple.com/documentation/CoreML/MLImageConstraint) by inspecting the [`MLModelDescription`](https://developer.apple.com/documentation/CoreML/MLModelDescription).
```
/// - Tag: ImageConstraintProperty
extension UpdatableDrawingClassifier {
    /// Returns the image constraint for the model's "drawing" input feature.
    var imageConstraint: MLImageConstraint {
        let description = model.modelDescription
        
        let inputName = "drawing"
        let imageInputDescription = description.inputDescriptionsByName[inputName]!
        
        return imageInputDescription.imageConstraint!
    }
}

```

### [Create an update task](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates#Create-an-update-task)
You create an [`MLUpdateTask`](https://developer.apple.com/documentation/CoreML/MLUpdateTask) by passing the following to an initializer:
  * An [`MLBatchProvider`](https://developer.apple.com/documentation/CoreML/MLBatchProvider) that contains your update data
  * The location of the compiled model youʼd like to update (_ModelName_`.mlmodelc`)
  * An [`MLModelConfiguration`](https://developer.apple.com/documentation/CoreML/MLModelConfiguration), if applicable
  * A completion handler with a single [`MLUpdateContext`](https://developer.apple.com/documentation/CoreML/MLUpdateContext) parameter


The sample updates the drawing classifier model it’s currently using, which could be the original drawing classifier model or a previously updated model.
```
// Create an Update Task.
guard let updateTask = try? MLUpdateTask(forModelAt: url,
                                   trainingData: trainingData,
                                   configuration: nil,
                                   completionHandler: completionHandler)
    else {
        print("Could't create an MLUpdateTask.")
        return
}

```

Important
An update task can only update a _compiled_ model file—one whose name ends with `.mlmodelc`.
### [Run the update task](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates#Run-the-update-task)
You begin an update task by calling its [`resume()`](https://developer.apple.com/documentation/CoreML/MLTask/resume\(\)) method.
```
updateTask.resume()

```

[Core ML](https://developer.apple.com/documentation/CoreML) updates the model on a separate thread and calls your completion handler when it finishes the update process.
### [Save the updated model](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates#Save-the-updated-model)
Use your completion handler to save the updated model in the [`MLUpdateContext`](https://developer.apple.com/documentation/CoreML/MLUpdateContext) to disk. The sample saves the updated model to the file system by first writing the model to a temporary location. Next, the sample moves the updated model to a permanent location, replacing any previously saved updated model.
```
let updatedModel = updateContext.model
let fileManager = FileManager.default
do {
    // Create a directory for the updated model.
    try fileManager.createDirectory(at: tempUpdatedModelURL,
                                    withIntermediateDirectories: true,
                                    attributes: nil)
    
    // Save the updated model to temporary filename.
    try updatedModel.write(to: tempUpdatedModelURL)
    
    // Replace any previously updated model with this one.
    _ = try fileManager.replaceItemAt(updatedModelURL,
                                      withItemAt: tempUpdatedModelURL)
    
    print("Updated model saved to:\n\t\(updatedModelURL)")
} catch let error {
    print("Could not save updated model to the file system: \(error)")
    return
}

```

### [Load the updated model](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates#Load-the-updated-model)
Use your updated model by loading it with the model’s [`init(contentsOf:)`](https://developer.apple.com/documentation/CoreML/MLModel/init\(contentsOf:\)) initializer. The sample loads a new instance of `UpdatableDrawingClassifier` with the [`URL`](https://developer.apple.com/documentation/Foundation/URL) of the updated model file the app saved in the previous step.
```
guard FileManager.default.fileExists(atPath: updatedModelURL.path) else {
    // The updated model is not present at its designated path.
    return
}


// Create an instance of the updated model.
guard let model = try? UpdatableDrawingClassifier(contentsOf: updatedModelURL) else {
    return
}


// Use this updated model to make predictions in the future.
updatedDrawingClassifier = model

```

## [See Also](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates#see-also)
### [On-device model updates](https://developer.apple.com/documentation/coreml/personalizing-a-model-with-on-device-updates#On-device-model-updates)
[`class MLTask`](https://developer.apple.com/documentation/coreml/mltask)
An abstract base class for machine learning tasks.
[`class MLUpdateTask`](https://developer.apple.com/documentation/coreml/mlupdatetask)
A task that updates a model with additional training data.
Current page is Personalizing a Model with On-Device Updates 
[Apple](https://www.apple.com)
  1. [Developer](https://developer.apple.com/)
  2. [ Documentation ](https://developer.apple.com/documentation/)


###  Platforms 
Toggle Menu 
  * [iOS](https://developer.apple.com/ios/)
  * [iPadOS](https://developer.apple.com/ipados/)
  * [macOS](https://developer.apple.com/macos/)
  * [tvOS](https://developer.apple.com/tvos/)
  * [visionOS](https://developer.apple.com/visionos/)
  * [watchOS](https://developer.apple.com/watchos/)


###  Tools 
Toggle Menu 
  * [Swift](https://developer.apple.com/swift/)
  * [SwiftUI](https://developer.apple.com/swiftui/)
  * [Swift Playground](https://developer.apple.com/swift-playground/)
  * [TestFlight](https://developer.apple.com/testflight/)
  * [Xcode](https://developer.apple.com/xcode/)
  * [Xcode Cloud](https://developer.apple.com/xcode-cloud/)
  * [SF Symbols](https://developer.apple.com/sf-symbols/)


###  Topics & Technologies 
Toggle Menu 
  * [Accessibility](https://developer.apple.com/accessibility/)
  * [Accessories](https://developer.apple.com/accessories/)
  * [App Extension](https://developer.apple.com/app-extensions/)
  * [App Store](https://developer.apple.com/app-store/)
  * [Audio & Video](https://developer.apple.com/audio/)
  * [Augmented Reality](https://developer.apple.com/augmented-reality/)
  * [Design](https://developer.apple.com/design/)
  * [Distribution](https://developer.apple.com/distribute/)
  * [Education](https://developer.apple.com/education/)
  * [Fonts](https://developer.apple.com/fonts/)
  * [Games](https://developer.apple.com/games/)
  * [Health & Fitness](https://developer.apple.com/health-fitness/)
  * [In-App Purchase](https://developer.apple.com/in-app-purchase/)
  * [Localization](https://developer.apple.com/localization/)
  * [Maps & Location](https://developer.apple.com/maps/)
  * [Machine Learning & AI](https://developer.apple.com/machine-learning/)
  * [Open Source](https://opensource.apple.com/)
  * [Security](https://developer.apple.com/security/)
  * [Safari & Web](https://developer.apple.com/safari/)


###  Resources 
Toggle Menu 
  *   * [Documentation](https://developer.apple.com/documentation/)
  * [Tutorials](https://developer.apple.com/learn/)
  * [Downloads](https://developer.apple.com/download/)
  * [Forums](https://developer.apple.com/forums/)
  * [Videos](https://developer.apple.com/videos/)


###  Support 
Toggle Menu 
  * [Support Articles](https://developer.apple.com/support/articles/)
  * [Contact Us](https://developer.apple.com/contact/)
  * [Bug Reporting](https://developer.apple.com/bug-reporting/)
  * [System Status](https://developer.apple.com/system-status/)


###  Account 
Toggle Menu 
  * [Apple Developer](https://developer.apple.com/account/)
  * [App Store Connect](https://appstoreconnect.apple.com/)
  * [Certificates, IDs, & Profiles](https://developer.apple.com/account/ios/certificate/)
  * [Feedback Assistant](https://feedbackassistant.apple.com/)


###  Programs 
Toggle Menu 
  * [Apple Developer Program](https://developer.apple.com/programs/)
  * [Apple Developer Enterprise Program](https://developer.apple.com/programs/enterprise/)
  * [App Store Small Business Program](https://developer.apple.com/app-store/small-business-program/)
  * [MFi Program](https://mfi.apple.com/)
  * [News Partner Program](https://developer.apple.com/programs/news-partner/)
  * [Video Partner Program](https://developer.apple.com/programs/video-partner/)
  * [Security Bounty Program](https://developer.apple.com/security-bounty/)
  * [Security Research Device Program](https://developer.apple.com/programs/security-research-device/)


###  Events 
Toggle Menu 
  * [Meet with Apple](https://developer.apple.com/events/)
  * [Apple Developer Centers](https://developer.apple.com/events/developer-centers/)
  * [App Store Awards](https://developer.apple.com/app-store/app-store-awards/)
  * [Apple Design Awards](https://developer.apple.com/design/awards/)
  * [Apple Developer Academies](https://developer.apple.com/academies/)
  * [WWDC](https://developer.apple.com/wwdc/)


To submit feedback on documentation, visit [Feedback Assistant](applefeedback://new?form_identifier=developertools.fba&answers%5B%3Aarea%5D=seedADC%3Adevpubs&answers%5B%3Adoc_type_req%5D=Technology%20Documentation&answers%5B%3Adocumentation_link_req%5D=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fcoreml%2Fpersonalizing-a-model-with-on-device-updates).
Select a color scheme preference
Light
Dark
Auto
Copyright © 2025 [Apple Inc.](https://www.apple.com) All rights reserved. 
[ Terms of Use ](https://www.apple.com/legal/internet-services/terms/site.html)[ Privacy Policy ](https://www.apple.com/legal/privacy/)[ Agreements and Guidelines ](https://developer.apple.com/support/terms/)
