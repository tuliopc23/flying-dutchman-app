Source: https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue

[ Skip Navigation ](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue#app-main)
  * [Global Nav Open Menu](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue#ac-gn-menustate)[Global Nav Close Menu](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue)
  * [Apple Developer](https://developer.apple.com/)


[ Search Developer Cancel  ](https://developer.apple.com/search/)
  * [Apple Developer](https://developer.apple.com/)
  * [News](https://developer.apple.com/news/)
  * [Discover](https://developer.apple.com/discover/)
  * [Design](https://developer.apple.com/design/)
  * [Develop](https://developer.apple.com/develop/)
  * [Distribute](https://developer.apple.com/distribute/)
  * [Support](https://developer.apple.com/support/)
  * [Account](https://developer.apple.com/account/)
  * [](https://developer.apple.com/search/)


Cancel 
Only search within “Documentation”
### Quick Links
  * [Downloads](https://developer.apple.com/download/)
  * [Documentation](https://developer.apple.com/documentation/)
  * [Sample Code](https://developer.apple.com/documentation/samplecode/)
  * [Videos](https://developer.apple.com/videos/)
  * [Forums](https://developer.apple.com/forums/)

5 Quick Links
[ Documentation ](https://developer.apple.com/documentation)
[ Open Menu ](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue)
  * SwiftLanguage:  Swift  Objective-C 
Language: 
    * Swift 
    * [ Objective-C ](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue)


[](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue)
## [ StoreKit  ](https://developer.apple.com/documentation/storekit)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
1 of 33 symbols inside <root>
In-App Purchase
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
2 of 33 symbols inside <root> containing 60 symbols[In-App Purchase](https://developer.apple.com/documentation/storekit/in-app-purchase)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
1 of 60 symbols inside -1505352393 
In-App Purchase merchandising
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
2 of 60 symbols inside -1505352393 containing 83 symbols[StoreKit views](https://developer.apple.com/documentation/storekit/storekit-views)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
3 of 60 symbols inside -1505352393 
Product and subscription information
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
4 of 60 symbols inside -1505352393 [Implementing a store in your app using the StoreKit API](https://developer.apple.com/documentation/storekit/implementing-a-store-in-your-app-using-the-storekit-api)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
5 of 60 symbols inside -1505352393 containing 45 symbols[Product](https://developer.apple.com/documentation/storekit/product)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
6 of 60 symbols inside -1505352393 containing 24 symbols[Product.SubscriptionInfo](https://developer.apple.com/documentation/storekit/product/subscriptioninfo)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
T
7 of 60 symbols inside -1505352393 [SubscriptionInfo](https://developer.apple.com/documentation/storekit/subscriptioninfo)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
T
8 of 60 symbols inside -1505352393 [SubscriptionStatus](https://developer.apple.com/documentation/storekit/subscriptionstatus)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
9 of 60 symbols inside -1505352393 
Purchase requests and results
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
10 of 60 symbols inside -1505352393 containing 4 symbols[PurchaseAction](https://developer.apple.com/documentation/storekit/purchaseaction)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
M
11 of 60 symbols inside -1505352393 [func purchase(options: Set<Product.PurchaseOption>) async throws -> Product.PurchaseResult](https://developer.apple.com/documentation/storekit/product/purchase\(options:\))
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
E
12 of 60 symbols inside -1505352393 containing 4 symbols[Product.PurchaseResult](https://developer.apple.com/documentation/storekit/product/purchaseresult)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
13 of 60 symbols inside -1505352393 
Transaction history and entitlements
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
14 of 60 symbols inside -1505352393 containing 41 symbols[Transaction](https://developer.apple.com/documentation/storekit/transaction)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
P
15 of 60 symbols inside -1505352393 [static var updates: Transaction.Transactions](https://developer.apple.com/documentation/storekit/transaction/updates)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
P
16 of 60 symbols inside -1505352393 [static var all: Transaction.Transactions](https://developer.apple.com/documentation/storekit/transaction/all)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
54 of 60 symbols inside -1505352393 [Sending Advanced Commerce API requests from your app](https://developer.apple.com/documentation/storekit/sending-advanced-commerce-api-requests-from-your-app)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
55 of 60 symbols inside -1505352393 [Generating JWS to sign App Store requests](https://developer.apple.com/documentation/storekit/generating-jws-to-sign-app-store-requests)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
55 of 60 symbols inside -1505352393 [Generating JWS to sign App Store requests](https://developer.apple.com/documentation/storekit/generating-jws-to-sign-app-store-requests)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
56 of 60 symbols inside -1505352393 
Errors
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
E
57 of 60 symbols inside -1505352393 containing 8 symbols[StoreKitError](https://developer.apple.com/documentation/storekit/storekiterror)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
58 of 60 symbols inside -1505352393 
Deprecated
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
59 of 60 symbols inside -1505352393 [Choosing a StoreKit API for In-App Purchases](https://developer.apple.com/documentation/storekit/choosing-a-storekit-api-for-in-app-purchases)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
60 of 60 symbols inside -1505352393 containing 60 symbols[Original API for In-App Purchase](https://developer.apple.com/documentation/storekit/original-api-for-in-app-purchase)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
1 of 60 symbols inside -864441183 
Essentials
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
2 of 60 symbols inside -864441183 [Setting up the transaction observer for the payment queue](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
3 of 60 symbols inside -864441183 [Offering, completing, and restoring in-app purchases](https://developer.apple.com/documentation/storekit/offering-completing-and-restoring-in-app-purchases)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
4 of 60 symbols inside -864441183 containing 27 symbols[SKPaymentQueue](https://developer.apple.com/documentation/storekit/skpaymentqueue)Deprecated
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
5 of 60 symbols inside -864441183 containing 15 symbols[SKPaymentTransactionObserver](https://developer.apple.com/documentation/storekit/skpaymenttransactionobserver)Deprecated
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
6 of 60 symbols inside -864441183 containing 4 symbols[SKPaymentQueueDelegate](https://developer.apple.com/documentation/storekit/skpaymentqueuedelegate)Deprecated
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
7 of 60 symbols inside -864441183 containing 6 symbols[SKRequest](https://developer.apple.com/documentation/storekit/skrequest)Deprecated
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
8 of 60 symbols inside -864441183 
Product information
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
9 of 60 symbols inside -864441183 [Loading in-app product identifiers](https://developer.apple.com/documentation/storekit/loading-in-app-product-identifiers)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
10 of 60 symbols inside -864441183 [Fetching product information from the App Store](https://developer.apple.com/documentation/storekit/fetching-product-information-from-the-app-store)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
11 of 60 symbols inside -864441183 containing 5 symbols[SKProductsRequest](https://developer.apple.com/documentation/storekit/skproductsrequest)Deprecated
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
12 of 60 symbols inside -864441183 containing 3 symbols[SKProductsResponse](https://developer.apple.com/documentation/storekit/skproductsresponse)Deprecated
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
13 of 60 symbols inside -864441183 containing 24 symbols[SKProduct](https://developer.apple.com/documentation/storekit/skproduct)Deprecated
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
14 of 60 symbols inside -864441183 
Storefronts
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
15 of 60 symbols inside -864441183 containing 3 symbols[SKStorefront](https://developer.apple.com/documentation/storekit/skstorefront)Deprecated
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
16 of 60 symbols inside -864441183 
Purchases
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
17 of 60 symbols inside -864441183 [Requesting a payment from the App Store](https://developer.apple.com/documentation/storekit/requesting-a-payment-from-the-app-store)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
18 of 60 symbols inside -864441183 [Processing a transaction](https://developer.apple.com/documentation/storekit/processing-a-transaction)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
19 of 60 symbols inside -864441183 containing 12 symbols[SKPayment](https://developer.apple.com/documentation/storekit/skpayment)Deprecated
153 items were found. Tab back to navigate through them. 
/ 
Navigator is ready 
  * [ StoreKit ](https://developer.apple.com/documentation/storekit)
  * [ In-App Purchase ](https://developer.apple.com/documentation/storekit/in-app-purchase)
  * [ Original API for In-App Purchase ](https://developer.apple.com/documentation/storekit/original-api-for-in-app-purchase)
  * [ Setting up the transaction observer for the payment queue ](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue)
  *     * [ In-App Purchase ](https://developer.apple.com/documentation/storekit/in-app-purchase)
    * [ Original API for In-App Purchase ](https://developer.apple.com/documentation/storekit/original-api-for-in-app-purchase)
    * Setting up the transaction observer for the payment queue 


Article
# Setting up the transaction observer for the payment queue
Enable your app to receive and handle transactions by adding an observer.
## [Overview](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue#overview)
To process transactions in your app, you need to create and add an observer to the payment queue. The observer object responds to new transactions and synchronizes the queue of pending transactions with the App Store, and the payment queue prompts users to authorize payment. It’s important to add the transaction observer at app launch to ensure you don’t miss payment queue notifications that the system may send when the app launches.
### [Create an observer](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue#Create-an-observer)
Create and build a custom observer class to handle changes to the payment queue.
```
class StoreObserver: NSObject, SKPaymentTransactionObserver {
                ....
    //Initialize the store observer.
    override init() {
        super.init()
        //Other initialization here.
    }


    //Observe transaction updates.
    func paymentQueue(_ queue: SKPaymentQueue,updatedTransactions transactions: [SKPaymentTransaction]) {
        //Handle transaction states here.
    }
                ....
}

```

Create an instance of this observer class to act as the observer of changes to the payment queue.
```
let iapObserver = StoreObserver()

```

Tip
Consider creating your observer as a shared instance of the class for global reference in any other class. A shared instance also ensures the lifetime of the object, so that the same instance handles callbacks for the [`SKPaymentTransactionObserver`](https://developer.apple.com/documentation/storekit/skpaymenttransactionobserver) protocol.
After you create the transaction observer, you can add it to the payment queue.
### [Add an observer](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue#Add-an-observer)
StoreKit attaches your observer to the queue when your app calls.
```
SKPaymentQueue.default().add(iapObserver)

```

StoreKit can notify your [`SKPaymentTransactionObserver`](https://developer.apple.com/documentation/storekit/skpaymenttransactionobserver) instance automatically when the content of the payment queue changes upon resuming or while running your app.
Implement the transaction observer.
```
import UIKit
import StoreKit


class AppDelegate: UIResponder, UIApplicationDelegate {
                ....
    // Attach an observer to the payment queue.
    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -> Bool {
        SKPaymentQueue.default().add(iapObserver)
        return true
    }


    // The system calls this when the app is about to terminate.
    func applicationWillTerminate(_ application: UIApplication) {
        // Remove the observer.
        SKPaymentQueue.default().remove(iapObserver)
    }
                ....
}

```

It’s important to add the observer at launch, in [`application(_:didFinishLaunchingWithOptions:)`](https://developer.apple.com/documentation/UIKit/UIApplicationDelegate/application\(_:didFinishLaunchingWithOptions:\)), to ensure that it persists during all launches of your app, receives all payment queue notifications, and continues transactions that may initiate outside the app, such as:
  * Promoted in-app purchases. For more information, see [Promoting In-App Purchases](https://developer.apple.com/documentation/storekit/promoting-in-app-purchases).
  * Background subscription renewals
  * Interrupted purchases


The observer needs to be persistent so the system doesn’t deallocate it when it sends the app to the background. Only a persistent observer can receive transactions that may occur while your app is in the background, such as a renewal transaction for an auto-renewable subscription.
## [See Also](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue#see-also)
### [Related Documentation](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue#Related-Documentation)
[`func add(any SKPaymentTransactionObserver)`](https://developer.apple.com/documentation/storekit/skpaymentqueue/add\(_:\)-5ciz2)
Adds an observer to the payment queue.
Deprecated
### [Essentials](https://developer.apple.com/documentation/storekit/setting-up-the-transaction-observer-for-the-payment-queue#Essentials)
[Offering, completing, and restoring in-app purchases](https://developer.apple.com/documentation/storekit/offering-completing-and-restoring-in-app-purchases)
Fetch, display, purchase, validate, and finish transactions in your app.
[`class SKPaymentQueue`](https://developer.apple.com/documentation/storekit/skpaymentqueue)
A queue of payment transactions for the App Store to process.
Deprecated
[`protocol SKPaymentTransactionObserver`](https://developer.apple.com/documentation/storekit/skpaymenttransactionobserver)
A set of methods that process transactions, unlock purchased functionality, and continue promoted In-App Purchases.
Deprecated
[`protocol SKPaymentQueueDelegate`](https://developer.apple.com/documentation/storekit/skpaymentqueuedelegate)
The protocol that provides information needed to complete transactions.
Deprecated
[`class SKRequest`](https://developer.apple.com/documentation/storekit/skrequest)
An abstract class that represents a request to the App Store.
Deprecated
Current page is Setting up the transaction observer for the payment queue 
[Apple](https://www.apple.com)
  1. [Developer](https://developer.apple.com/)
  2. [ Documentation ](https://developer.apple.com/documentation/)


###  Platforms 
Toggle Menu 
  * [iOS](https://developer.apple.com/ios/)
  * [iPadOS](https://developer.apple.com/ipados/)
  * [macOS](https://developer.apple.com/macos/)
  * [tvOS](https://developer.apple.com/tvos/)
  * [visionOS](https://developer.apple.com/visionos/)
  * [watchOS](https://developer.apple.com/watchos/)


###  Tools 
Toggle Menu 
  * [Swift](https://developer.apple.com/swift/)
  * [SwiftUI](https://developer.apple.com/swiftui/)
  * [Swift Playground](https://developer.apple.com/swift-playground/)
  * [TestFlight](https://developer.apple.com/testflight/)
  * [Xcode](https://developer.apple.com/xcode/)
  * [Xcode Cloud](https://developer.apple.com/xcode-cloud/)
  * [SF Symbols](https://developer.apple.com/sf-symbols/)


###  Topics & Technologies 
Toggle Menu 
  * [Accessibility](https://developer.apple.com/accessibility/)
  * [Accessories](https://developer.apple.com/accessories/)
  * [App Extension](https://developer.apple.com/app-extensions/)
  * [App Store](https://developer.apple.com/app-store/)
  * [Audio & Video](https://developer.apple.com/audio/)
  * [Augmented Reality](https://developer.apple.com/augmented-reality/)
  * [Design](https://developer.apple.com/design/)
  * [Distribution](https://developer.apple.com/distribute/)
  * [Education](https://developer.apple.com/education/)
  * [Fonts](https://developer.apple.com/fonts/)
  * [Games](https://developer.apple.com/games/)
  * [Health & Fitness](https://developer.apple.com/health-fitness/)
  * [In-App Purchase](https://developer.apple.com/in-app-purchase/)
  * [Localization](https://developer.apple.com/localization/)
  * [Maps & Location](https://developer.apple.com/maps/)
  * [Machine Learning & AI](https://developer.apple.com/machine-learning/)
  * [Open Source](https://opensource.apple.com/)
  * [Security](https://developer.apple.com/security/)
  * [Safari & Web](https://developer.apple.com/safari/)


###  Resources 
Toggle Menu 
  *   * [Documentation](https://developer.apple.com/documentation/)
  * [Tutorials](https://developer.apple.com/learn/)
  * [Downloads](https://developer.apple.com/download/)
  * [Forums](https://developer.apple.com/forums/)
  * [Videos](https://developer.apple.com/videos/)


###  Support 
Toggle Menu 
  * [Support Articles](https://developer.apple.com/support/articles/)
  * [Contact Us](https://developer.apple.com/contact/)
  * [Bug Reporting](https://developer.apple.com/bug-reporting/)
  * [System Status](https://developer.apple.com/system-status/)


###  Account 
Toggle Menu 
  * [Apple Developer](https://developer.apple.com/account/)
  * [App Store Connect](https://appstoreconnect.apple.com/)
  * [Certificates, IDs, & Profiles](https://developer.apple.com/account/ios/certificate/)
  * [Feedback Assistant](https://feedbackassistant.apple.com/)


###  Programs 
Toggle Menu 
  * [Apple Developer Program](https://developer.apple.com/programs/)
  * [Apple Developer Enterprise Program](https://developer.apple.com/programs/enterprise/)
  * [App Store Small Business Program](https://developer.apple.com/app-store/small-business-program/)
  * [MFi Program](https://mfi.apple.com/)
  * [News Partner Program](https://developer.apple.com/programs/news-partner/)
  * [Video Partner Program](https://developer.apple.com/programs/video-partner/)
  * [Security Bounty Program](https://developer.apple.com/security-bounty/)
  * [Security Research Device Program](https://developer.apple.com/programs/security-research-device/)


###  Events 
Toggle Menu 
  * [Meet with Apple](https://developer.apple.com/events/)
  * [Apple Developer Centers](https://developer.apple.com/events/developer-centers/)
  * [App Store Awards](https://developer.apple.com/app-store/app-store-awards/)
  * [Apple Design Awards](https://developer.apple.com/design/awards/)
  * [Apple Developer Academies](https://developer.apple.com/academies/)
  * [WWDC](https://developer.apple.com/wwdc/)


To submit feedback on documentation, visit [Feedback Assistant](applefeedback://new?form_identifier=developertools.fba&answers%5B%3Aarea%5D=seedADC%3Adevpubs&answers%5B%3Adoc_type_req%5D=Technology%20Documentation&answers%5B%3Adocumentation_link_req%5D=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fstorekit%2Fsetting-up-the-transaction-observer-for-the-payment-queue).
Select a color scheme preference
Light
Dark
Auto
Copyright © 2025 [Apple Inc.](https://www.apple.com) All rights reserved. 
[ Terms of Use ](https://www.apple.com/legal/internet-services/terms/site.html)[ Privacy Policy ](https://www.apple.com/legal/privacy/)[ Agreements and Guidelines ](https://developer.apple.com/support/terms/)
