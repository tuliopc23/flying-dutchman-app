Source: https://developer.apple.com/documentation/coredata/staged-migrations

[ Skip Navigation ](https://developer.apple.com/documentation/coredata/staged-migrations#app-main)
  * [Global Nav Open Menu](https://developer.apple.com/documentation/coredata/staged-migrations#ac-gn-menustate)[Global Nav Close Menu](https://developer.apple.com/documentation/coredata/staged-migrations)
  * [Apple Developer](https://developer.apple.com/)


[ Search Developer Cancel  ](https://developer.apple.com/search/)
  * [Apple Developer](https://developer.apple.com/)
  * [News](https://developer.apple.com/news/)
  * [Discover](https://developer.apple.com/discover/)
  * [Design](https://developer.apple.com/design/)
  * [Develop](https://developer.apple.com/develop/)
  * [Distribute](https://developer.apple.com/distribute/)
  * [Support](https://developer.apple.com/support/)
  * [Account](https://developer.apple.com/account/)
  * [](https://developer.apple.com/search/)


Cancel 
Only search within “Documentation”
### Quick Links
  * [Downloads](https://developer.apple.com/download/)
  * [Documentation](https://developer.apple.com/documentation/)
  * [Sample Code](https://developer.apple.com/documentation/samplecode/)
  * [Videos](https://developer.apple.com/videos/)
  * [Forums](https://developer.apple.com/forums/)

5 Quick Links
[ Documentation ](https://developer.apple.com/documentation)
[ Open Menu ](https://developer.apple.com/documentation/coredata/staged-migrations)
  * SwiftLanguage:  Swift  Objective-C 
Language: 
    * Swift 
    * [ Objective-C ](https://developer.apple.com/documentation/coredata/staged-migrations)


[](https://developer.apple.com/documentation/coredata/staged-migrations)
## [ Core Data  ](https://developer.apple.com/documentation/coredata)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
2 of 37 symbols inside <root> [Creating a Core Data model](https://developer.apple.com/documentation/coredata/creating-a-core-data-model)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
3 of 37 symbols inside <root> containing 2 symbols[Setting up a Core Data stack](https://developer.apple.com/documentation/coredata/setting-up-a-core-data-stack)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
4 of 37 symbols inside <root> containing 25 symbols[Core Data stack](https://developer.apple.com/documentation/coredata/core-data-stack)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
5 of 37 symbols inside <root> [Handling Different Data Types in Core Data](https://developer.apple.com/documentation/coredata/handling-different-data-types-in-core-data)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
6 of 37 symbols inside <root> [Linking Data Between Two Core Data Stores](https://developer.apple.com/documentation/coredata/linking-data-between-two-core-data-stores)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
7 of 37 symbols inside <root>
Data modeling
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
8 of 37 symbols inside <root> containing 5 symbols[Modeling data](https://developer.apple.com/documentation/coredata/modeling-data)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
9 of 37 symbols inside <root> containing 13 symbols[Core Data model](https://developer.apple.com/documentation/coredata/core-data-model)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
10 of 37 symbols inside <root>
Fetch requests
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
11 of 37 symbols inside <root> containing 35 symbols[NSFetchRequest](https://developer.apple.com/documentation/coredata/nsfetchrequest)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
12 of 37 symbols inside <root> containing 6 symbols[NSAsynchronousFetchRequest](https://developer.apple.com/documentation/coredata/nsasynchronousfetchrequest)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
13 of 37 symbols inside <root> containing 3 symbols[NSAsynchronousFetchResult](https://developer.apple.com/documentation/coredata/nsasynchronousfetchresult)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
14 of 37 symbols inside <root> containing 25 symbols[NSFetchedResultsController](https://developer.apple.com/documentation/coredata/nsfetchedresultscontroller)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
15 of 37 symbols inside <root>
SwiftData migration and coexistence
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
16 of 37 symbols inside <root> [Adopting SwiftData for a Core Data app](https://developer.apple.com/documentation/coredata/adopting-swiftdata-for-a-core-data-app)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
17 of 37 symbols inside <root>
CloudKit mirroring
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
18 of 37 symbols inside <root> containing 5 symbols[Mirroring a Core Data store with CloudKit](https://developer.apple.com/documentation/coredata/mirroring-a-core-data-store-with-cloudkit)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
26 of 37 symbols inside <root> containing 8 symbols[Persistent history](https://developer.apple.com/documentation/coredata/persistent-history)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
26 of 37 symbols inside <root> containing 8 symbols[Persistent history](https://developer.apple.com/documentation/coredata/persistent-history)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
27 of 37 symbols inside <root>
Background tasks
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
28 of 37 symbols inside <root> [Using Core Data in the background](https://developer.apple.com/documentation/coredata/using-core-data-in-the-background)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
29 of 37 symbols inside <root> [Loading and displaying a large data feed](https://developer.apple.com/documentation/swiftui/loading-and-displaying-a-large-data-feed)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
30 of 37 symbols inside <root> containing 5 symbols[Conflict resolution](https://developer.apple.com/documentation/coredata/conflict-resolution)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
31 of 37 symbols inside <root> containing 9 symbols[Batch processing](https://developer.apple.com/documentation/coredata/batch-processing)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
32 of 37 symbols inside <root>
Data model migration
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
33 of 37 symbols inside <root> [Migrating your data model automatically](https://developer.apple.com/documentation/coredata/migrating-your-data-model-automatically)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
34 of 37 symbols inside <root> containing 7 symbols[Staged migrations](https://developer.apple.com/documentation/coredata/staged-migrations)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
1 of 7 symbols inside -1160178257 
Migration staging
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
V
2 of 7 symbols inside -1160178257 [let NSPersistentStoreStagedMigrationManagerOptionKey: String](https://developer.apple.com/documentation/coredata/nspersistentstorestagedmigrationmanageroptionkey)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
3 of 7 symbols inside -1160178257 containing 6 symbols[NSStagedMigrationManager](https://developer.apple.com/documentation/coredata/nsstagedmigrationmanager)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
4 of 7 symbols inside -1160178257 
Migration stages
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
5 of 7 symbols inside -1160178257 containing 4 symbols[NSLightweightMigrationStage](https://developer.apple.com/documentation/coredata/nslightweightmigrationstage)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
6 of 7 symbols inside -1160178257 containing 9 symbols[NSCustomMigrationStage](https://developer.apple.com/documentation/coredata/nscustommigrationstage)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
7 of 7 symbols inside -1160178257 containing 2 symbols[NSMigrationStage](https://developer.apple.com/documentation/coredata/nsmigrationstage)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
35 of 37 symbols inside <root> containing 7 symbols[Manual migrations](https://developer.apple.com/documentation/coredata/manual-migrations)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
36 of 37 symbols inside <root>
Related types
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
37 of 37 symbols inside <root> containing 60 symbols[Core Data Constants](https://developer.apple.com/documentation/coredata/core-data-constants)
44 items were found. Tab back to navigate through them. 
/ 
Navigator is ready 
Collection
  * [ Core Data ](https://developer.apple.com/documentation/coredata)
  * [ Staged migrations ](https://developer.apple.com/documentation/coredata/staged-migrations)
  *     * Staged migrations 


API Collection
# Staged migrations
Migrate complex data models containing changes that are incompatible with lightweight migrations.
## [Overview](https://developer.apple.com/documentation/coredata/staged-migrations#overview)
Core Data uses lightweight migrations to keep the data in your app’s persistent store consistent with the app’s managed object model. A lightweight migration automatically determines the differences between two model versions and generates a mapping model that Core Data then uses to make the necessary changes to the persistent store. Lightweight migrations support a number of common operations, such as adding an entity, removing a relationship, changing a nonoptional attribute to an optional attribute, renaming an entity, and so on.
As your object model evolves, you may find that the aggregate changes between two model versions exceed the capabilities of lightweight migrations. For example, if you change an optional attribute to be nonoptional, there’s no way for a lightweight migration to infer the default value it needs to assign to any instances of that attribute with a `nil` value.
_Staged lightweight migrations_ solve this problem by reducing an incompatible migration into a series of compatible stages. A migration manager runs these stages in a specific order, providing opportunities for you to prepare the persistent store before each stage runs, and perform any cleanup afterward. This enables you to handle scenarios like changing an optional attribute to be nonoptional because you have an opportunity to set any `nil` values to a concrete value before the stage runs.
Important
Successful Core Data migrations depend on properly versioned object models, and staged lightweight migrations require a distinct migration stage for each model version.
## [Topics](https://developer.apple.com/documentation/coredata/staged-migrations#topics)
### [Migration staging](https://developer.apple.com/documentation/coredata/staged-migrations#Migration-staging)
[`let NSPersistentStoreStagedMigrationManagerOptionKey: String`](https://developer.apple.com/documentation/coredata/nspersistentstorestagedmigrationmanageroptionkey)
The key for specifying your staged migration manager.
[`class NSStagedMigrationManager`](https://developer.apple.com/documentation/coredata/nsstagedmigrationmanager)
An object that handles the migration event loop and provides access to the migrating persistent store.
### [Migration stages](https://developer.apple.com/documentation/coredata/staged-migrations#Migration-stages)
[`class NSLightweightMigrationStage`](https://developer.apple.com/documentation/coredata/nslightweightmigrationstage)
An object that describes a series of models suitable for lightweight migration.
[`class NSCustomMigrationStage`](https://developer.apple.com/documentation/coredata/nscustommigrationstage)
An object that enables you to participate in the migration between two versions of the same model.
[`class NSMigrationStage`](https://developer.apple.com/documentation/coredata/nsmigrationstage)
An abstract base class for describing an individual stage of a migration.
## [See Also](https://developer.apple.com/documentation/coredata/staged-migrations#see-also)
### [Data model migration](https://developer.apple.com/documentation/coredata/staged-migrations#Data-model-migration)
[Migrating your data model automatically](https://developer.apple.com/documentation/coredata/migrating-your-data-model-automatically)
Enable lightweight migrations to keep your data model and the underlying data in a consistent state.
[API Reference Manual migrations](https://developer.apple.com/documentation/coredata/manual-migrations)
Migrate elaborate data models with changes that go beyond the capabilities of both lightweight and staged migrations.
Current page is Staged migrations 
[Apple](https://www.apple.com)
  1. [Developer](https://developer.apple.com/)
  2. [ Documentation ](https://developer.apple.com/documentation/)


###  Platforms 
Toggle Menu 
  * [iOS](https://developer.apple.com/ios/)
  * [iPadOS](https://developer.apple.com/ipados/)
  * [macOS](https://developer.apple.com/macos/)
  * [tvOS](https://developer.apple.com/tvos/)
  * [visionOS](https://developer.apple.com/visionos/)
  * [watchOS](https://developer.apple.com/watchos/)


###  Tools 
Toggle Menu 
  * [Swift](https://developer.apple.com/swift/)
  * [SwiftUI](https://developer.apple.com/swiftui/)
  * [Swift Playground](https://developer.apple.com/swift-playground/)
  * [TestFlight](https://developer.apple.com/testflight/)
  * [Xcode](https://developer.apple.com/xcode/)
  * [Xcode Cloud](https://developer.apple.com/xcode-cloud/)
  * [SF Symbols](https://developer.apple.com/sf-symbols/)


###  Topics & Technologies 
Toggle Menu 
  * [Accessibility](https://developer.apple.com/accessibility/)
  * [Accessories](https://developer.apple.com/accessories/)
  * [App Extension](https://developer.apple.com/app-extensions/)
  * [App Store](https://developer.apple.com/app-store/)
  * [Audio & Video](https://developer.apple.com/audio/)
  * [Augmented Reality](https://developer.apple.com/augmented-reality/)
  * [Design](https://developer.apple.com/design/)
  * [Distribution](https://developer.apple.com/distribute/)
  * [Education](https://developer.apple.com/education/)
  * [Fonts](https://developer.apple.com/fonts/)
  * [Games](https://developer.apple.com/games/)
  * [Health & Fitness](https://developer.apple.com/health-fitness/)
  * [In-App Purchase](https://developer.apple.com/in-app-purchase/)
  * [Localization](https://developer.apple.com/localization/)
  * [Maps & Location](https://developer.apple.com/maps/)
  * [Machine Learning & AI](https://developer.apple.com/machine-learning/)
  * [Open Source](https://opensource.apple.com/)
  * [Security](https://developer.apple.com/security/)
  * [Safari & Web](https://developer.apple.com/safari/)


###  Resources 
Toggle Menu 
  *   * [Documentation](https://developer.apple.com/documentation/)
  * [Tutorials](https://developer.apple.com/learn/)
  * [Downloads](https://developer.apple.com/download/)
  * [Forums](https://developer.apple.com/forums/)
  * [Videos](https://developer.apple.com/videos/)


###  Support 
Toggle Menu 
  * [Support Articles](https://developer.apple.com/support/articles/)
  * [Contact Us](https://developer.apple.com/contact/)
  * [Bug Reporting](https://developer.apple.com/bug-reporting/)
  * [System Status](https://developer.apple.com/system-status/)


###  Account 
Toggle Menu 
  * [Apple Developer](https://developer.apple.com/account/)
  * [App Store Connect](https://appstoreconnect.apple.com/)
  * [Certificates, IDs, & Profiles](https://developer.apple.com/account/ios/certificate/)
  * [Feedback Assistant](https://feedbackassistant.apple.com/)


###  Programs 
Toggle Menu 
  * [Apple Developer Program](https://developer.apple.com/programs/)
  * [Apple Developer Enterprise Program](https://developer.apple.com/programs/enterprise/)
  * [App Store Small Business Program](https://developer.apple.com/app-store/small-business-program/)
  * [MFi Program](https://mfi.apple.com/)
  * [News Partner Program](https://developer.apple.com/programs/news-partner/)
  * [Video Partner Program](https://developer.apple.com/programs/video-partner/)
  * [Security Bounty Program](https://developer.apple.com/security-bounty/)
  * [Security Research Device Program](https://developer.apple.com/programs/security-research-device/)


###  Events 
Toggle Menu 
  * [Meet with Apple](https://developer.apple.com/events/)
  * [Apple Developer Centers](https://developer.apple.com/events/developer-centers/)
  * [App Store Awards](https://developer.apple.com/app-store/app-store-awards/)
  * [Apple Design Awards](https://developer.apple.com/design/awards/)
  * [Apple Developer Academies](https://developer.apple.com/academies/)
  * [WWDC](https://developer.apple.com/wwdc/)


To submit feedback on documentation, visit [Feedback Assistant](applefeedback://new?form_identifier=developertools.fba&answers%5B%3Aarea%5D=seedADC%3Adevpubs&answers%5B%3Adoc_type_req%5D=Technology%20Documentation&answers%5B%3Adocumentation_link_req%5D=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fcoredata%2Fstaged-migrations).
Select a color scheme preference
Light
Dark
Auto
Copyright © 2025 [Apple Inc.](https://www.apple.com) All rights reserved. 
[ Terms of Use ](https://www.apple.com/legal/internet-services/terms/site.html)[ Privacy Policy ](https://www.apple.com/legal/privacy/)[ Agreements and Guidelines ](https://developer.apple.com/support/terms/)
