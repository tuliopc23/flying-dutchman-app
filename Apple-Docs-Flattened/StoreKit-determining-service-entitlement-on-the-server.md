Source: https://developer.apple.com/documentation/StoreKit/determining-service-entitlement-on-the-server

[ Skip Navigation ](https://developer.apple.com/documentation/StoreKit/determining-service-entitlement-on-the-server#app-main)
  * [Global Nav Open Menu](https://developer.apple.com/documentation/StoreKit/determining-service-entitlement-on-the-server#ac-gn-menustate)[Global Nav Close Menu](https://developer.apple.com/documentation/StoreKit/determining-service-entitlement-on-the-server)
  * [Apple Developer](https://developer.apple.com/)


[ Search Developer Cancel  ](https://developer.apple.com/search/)
  * [Apple Developer](https://developer.apple.com/)
  * [News](https://developer.apple.com/news/)
  * [Discover](https://developer.apple.com/discover/)
  * [Design](https://developer.apple.com/design/)
  * [Develop](https://developer.apple.com/develop/)
  * [Distribute](https://developer.apple.com/distribute/)
  * [Support](https://developer.apple.com/support/)
  * [Account](https://developer.apple.com/account/)
  * [](https://developer.apple.com/search/)


Cancel 
Only search within “Documentation”
### Quick Links
  * [Downloads](https://developer.apple.com/download/)
  * [Documentation](https://developer.apple.com/documentation/)
  * [Sample Code](https://developer.apple.com/documentation/samplecode/)
  * [Videos](https://developer.apple.com/videos/)
  * [Forums](https://developer.apple.com/forums/)

5 Quick Links
[ Documentation ](https://developer.apple.com/documentation)
[ Open Menu ](https://developer.apple.com/documentation/StoreKit/determining-service-entitlement-on-the-server)
  * SwiftLanguage:  Swift  Objective-C 
Language: 
    * Swift 
    * [ Objective-C ](https://developer.apple.com/documentation/StoreKit/determining-service-entitlement-on-the-server)


[](https://developer.apple.com/documentation/StoreKit/determining-service-entitlement-on-the-server)
## [ StoreKit  ](https://developer.apple.com/documentation/storekit)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
1 of 33 symbols inside <root>
In-App Purchase
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
2 of 33 symbols inside <root> containing 60 symbols[In-App Purchase](https://developer.apple.com/documentation/storekit/in-app-purchase)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
1 of 60 symbols inside -1505352393 
In-App Purchase merchandising
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
2 of 60 symbols inside -1505352393 containing 83 symbols[StoreKit views](https://developer.apple.com/documentation/storekit/storekit-views)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
3 of 60 symbols inside -1505352393 
Product and subscription information
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
4 of 60 symbols inside -1505352393 [Implementing a store in your app using the StoreKit API](https://developer.apple.com/documentation/storekit/implementing-a-store-in-your-app-using-the-storekit-api)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
5 of 60 symbols inside -1505352393 containing 45 symbols[Product](https://developer.apple.com/documentation/storekit/product)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
6 of 60 symbols inside -1505352393 containing 24 symbols[Product.SubscriptionInfo](https://developer.apple.com/documentation/storekit/product/subscriptioninfo)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
T
7 of 60 symbols inside -1505352393 [SubscriptionInfo](https://developer.apple.com/documentation/storekit/subscriptioninfo)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
T
8 of 60 symbols inside -1505352393 [SubscriptionStatus](https://developer.apple.com/documentation/storekit/subscriptionstatus)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
9 of 60 symbols inside -1505352393 
Purchase requests and results
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
10 of 60 symbols inside -1505352393 containing 4 symbols[PurchaseAction](https://developer.apple.com/documentation/storekit/purchaseaction)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
M
11 of 60 symbols inside -1505352393 [func purchase(options: Set<Product.PurchaseOption>) async throws -> Product.PurchaseResult](https://developer.apple.com/documentation/storekit/product/purchase\(options:\))
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
E
12 of 60 symbols inside -1505352393 containing 4 symbols[Product.PurchaseResult](https://developer.apple.com/documentation/storekit/product/purchaseresult)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
13 of 60 symbols inside -1505352393 
Transaction history and entitlements
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
14 of 60 symbols inside -1505352393 containing 41 symbols[Transaction](https://developer.apple.com/documentation/storekit/transaction)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
P
15 of 60 symbols inside -1505352393 [static var updates: Transaction.Transactions](https://developer.apple.com/documentation/storekit/transaction/updates)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
P
16 of 60 symbols inside -1505352393 [static var all: Transaction.Transactions](https://developer.apple.com/documentation/storekit/transaction/all)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
11 of 19 symbols inside -1542378196 [Setting up promotional offers](https://developer.apple.com/documentation/storekit/setting-up-promotional-offers)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
12 of 19 symbols inside -1542378196 [Implementing promotional offers in your app](https://developer.apple.com/documentation/storekit/implementing-promotional-offers-in-your-app)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
12 of 19 symbols inside -1542378196 [Implementing promotional offers in your app](https://developer.apple.com/documentation/storekit/implementing-promotional-offers-in-your-app)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
13 of 19 symbols inside -1542378196 [Generating a signature for promotional offers](https://developer.apple.com/documentation/storekit/generating-a-signature-for-promotional-offers)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
14 of 19 symbols inside -1542378196 [Generating a Promotional Offer Signature on the Server](https://developer.apple.com/documentation/storekit/generating-a-promotional-offer-signature-on-the-server)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
15 of 19 symbols inside -1542378196 containing 9 symbols[SKPaymentDiscount](https://developer.apple.com/documentation/storekit/skpaymentdiscount)Deprecated
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
16 of 19 symbols inside -1542378196 
Offer codes
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
17 of 19 symbols inside -1542378196 [Implementing offer codes in your app](https://developer.apple.com/documentation/storekit/implementing-offer-codes-in-your-app)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
18 of 19 symbols inside -1542378196 
Subscription service entitlement
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
19 of 19 symbols inside -1542378196 [Determining service entitlement on the server](https://developer.apple.com/documentation/storekit/determining-service-entitlement-on-the-server)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
47 of 60 symbols inside -864441183 
Promotions
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
48 of 60 symbols inside -864441183 [Promoting In-App Purchases](https://developer.apple.com/documentation/storekit/promoting-in-app-purchases)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
49 of 60 symbols inside -864441183 [Testing promoted In-App Purchases](https://developer.apple.com/documentation/storekit/testing-promoted-in-app-purchases)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
50 of 60 symbols inside -864441183 containing 9 symbols[SKProductStorePromotionController](https://developer.apple.com/documentation/storekit/skproductstorepromotioncontroller)Deprecated
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
51 of 60 symbols inside -864441183 
Testing In-App Purchases
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
52 of 60 symbols inside -864441183 [Testing at all stages of development with Xcode and the sandbox](https://developer.apple.com/documentation/storekit/testing-at-all-stages-of-development-with-xcode-and-the-sandbox)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
53 of 60 symbols inside -864441183 [Setting up StoreKit Testing in Xcode](https://developer.apple.com/documentation/xcode/setting-up-storekit-testing-in-xcode)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
54 of 60 symbols inside -864441183 [Testing In-App Purchases in Xcode](https://developer.apple.com/documentation/storekit/testing-in-app-purchases-in-xcode)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
55 of 60 symbols inside -864441183 containing 26 symbols[Testing In-App Purchases with sandbox](https://developer.apple.com/documentation/storekit/testing-in-app-purchases-with-sandbox)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
56 of 60 symbols inside -864441183 
Errors
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
57 of 60 symbols inside -864441183 [Handling errors](https://developer.apple.com/documentation/storekit/handling-errors)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
E
58 of 60 symbols inside -864441183 containing 24 symbols[SKError.Code](https://developer.apple.com/documentation/storekit/skerror/code)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
59 of 60 symbols inside -864441183 containing 27 symbols[SKError](https://developer.apple.com/documentation/storekit/skerror)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
V
60 of 60 symbols inside -864441183 [let SKErrorDomain: String](https://developer.apple.com/documentation/storekit/skerrordomain)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
3 of 33 symbols inside <root> [Understanding StoreKit workflows](https://developer.apple.com/documentation/storekit/understanding-storekit-workflows)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
4 of 33 symbols inside <root> [Getting started with In-App Purchase using StoreKit views](https://developer.apple.com/documentation/storekit/getting-started-with-in-app-purchases-using-storekit-views)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
5 of 33 symbols inside <root>
App transaction
172 items were found. Tab back to navigate through them. 
/ 
Navigator is ready 
  * [ StoreKit ](https://developer.apple.com/documentation/storekit)
  * [ In-App Purchase ](https://developer.apple.com/documentation/storekit/in-app-purchase)
  * [ Original API for In-App Purchase ](https://developer.apple.com/documentation/storekit/original-api-for-in-app-purchase)
  * [ Subscriptions and offers ](https://developer.apple.com/documentation/storekit/subscriptions-and-offers)
  * [ Determining service entitlement on the server ](https://developer.apple.com/documentation/StoreKit/determining-service-entitlement-on-the-server)
  *     * [ In-App Purchase ](https://developer.apple.com/documentation/storekit/in-app-purchase)
    * [ Original API for In-App Purchase ](https://developer.apple.com/documentation/storekit/original-api-for-in-app-purchase)
    * [ Subscriptions and offers ](https://developer.apple.com/documentation/storekit/subscriptions-and-offers)
    * Determining service entitlement on the server 


Sample Code
# Determining service entitlement on the server
Identify a customer’s entitlement to your service, offers, and messaging by analyzing a validated receipt and the state of their subscription.
[ Download ](https://docs-assets.developer.apple.com/published/8334bfef2b2e/DeterminingServiceEntitlementOnTheServer.zip)
## [Overview](https://developer.apple.com/documentation/StoreKit/determining-service-entitlement-on-the-server#Overview)
Note
This sample code project is associated with WWDC22 session [110404: Implement proactive in-app purchase restore](https://developer.apple.com/wwdc22/110404/).
It’s also associated with WWDC 2020 session [10671: Architecting for Subscriptions](https://developer.apple.com/wwdc20/10671/).
When your app provides a subscription service, you receive data in the form of in-app receipts and App Store server notifications that provide a subscription’s state. After reading this data, your app determines whether to allow or restrict the user’s access to service, products, offers, and messages.
This server-side sample code project analyzes a receipt to help the app determine entitlement by systematically examining all potential subscription states that affect service entitlement, such as offers periods and billing states. The output from this sample’s REST API endpoints is a response that indicates whether the app can enable service or needs to perform other steps to retain or communicate with customers. You can extend this code and customize the response based on your own business logic. The sample code contains two endpoints:
  * URL: `localhost:3000/simulate` — Use `/simulate` for testing using real or artificial receipts. This endpoint requires no special configuration.
  * URL: `localhost:3000/entitle` — Use `/entitle` with real Base64-encoded receipts. This endpoint requires additional configuration.


### [Configure the sample code project](https://developer.apple.com/documentation/StoreKit/determining-service-entitlement-on-the-server#Configure-the-sample-code-project)
Follow these steps to run the sample code project:
  1. Install the latest stable version of Node.js.
  2. Open the Terminal app (`/Applications/Utilities`).
  3. Navigate to the sample code `/Sample` directory.
  4. In Terminal, enter `npm install` and press Return. Make sure it completes successfully.
  5. In Terminal, copy the example environment file: `cp env.example`.
  6. In Terminal, enter `npm start` and press Return to start the server. The server runs in your Terminal window. To stop the server, press Control-C while in Terminal.
  7. In Terminal, choose Shell > New Windows > New Window with Profile to open a second Teminal window to use to send the requests.


### [Send a request using sample receipt data](https://developer.apple.com/documentation/StoreKit/determining-service-entitlement-on-the-server#Send-a-request-using-sample-receipt-data)
The requests to the service entitlement engine take JSON data from a receipt. The data must be in the same JSON format that you receive by calling the `/verifyReceipt` endpoint when you pass it a valid receipt. The example file `flatJSONExample` in the `Source/Example` directory contains sample receipt data in the correct format for the requests.
To run the request, switch to the second Terminal window and type the following `curl` command. Replace the `<FLAT JSON DATA>` with the `flatJSONExample`.
```
curl -XPOST -H "Content-type: application/json" -d '<FLAT JSON DATA>' 'localhost:3000/simulate'

```

If the mocked JSON receipt data is in the correct format, the response contains the analyzed data the entitlement engine produces based on the receipt data.
If you have real receipt data, replace the `<FLAT JSON DATA>` in the command with your receipt data.
### [Receive the sample response](https://developer.apple.com/documentation/StoreKit/determining-service-entitlement-on-the-server#Receive-the-sample-response)
The response contains the result of the engine’s analysis of the receipt data. Use it to determine whether a customer has the necessary entitlements to service, offers, or other messaging. The response object contains an array of subscription objects organized by product ID, each containing fields that provide insights for that subscription.
The following example response shows a customer who was previously subscribed and then resubscribed. The customer is in state 5, which indicates an active subscription with autorenew still in an enabled state.
```
{
    "products": [
        {
            "product_id": "com.example.monthly",
            "entitlementCode": 5,
            "expiration": 1599391591000,
            "totalRenewals": 7,
            "groupID": "13472270",
            "originalTransactions": [
                {
                    "originalTX": "190000625698817",
                    "start": 1564455960000,
                    "expiration": 1599391591000,
                    "renewals": 7
                }
            ],
            "trialConsumed": true
        }
    ],
    "trialConsumedForGroup": [
        "13472270"
    ]
}

```

In this case, the sample app issues an offer for a yearly subscription to the customer because they’re in state `5`, and they have a history of seven total renewals.
Current page is Determining service entitlement on the server 
[Apple](https://www.apple.com)
  1. [Developer](https://developer.apple.com/)
  2. [ Documentation ](https://developer.apple.com/documentation/)


###  Platforms 
Toggle Menu 
  * [iOS](https://developer.apple.com/ios/)
  * [iPadOS](https://developer.apple.com/ipados/)
  * [macOS](https://developer.apple.com/macos/)
  * [tvOS](https://developer.apple.com/tvos/)
  * [visionOS](https://developer.apple.com/visionos/)
  * [watchOS](https://developer.apple.com/watchos/)


###  Tools 
Toggle Menu 
  * [Swift](https://developer.apple.com/swift/)
  * [SwiftUI](https://developer.apple.com/swiftui/)
  * [Swift Playground](https://developer.apple.com/swift-playground/)
  * [TestFlight](https://developer.apple.com/testflight/)
  * [Xcode](https://developer.apple.com/xcode/)
  * [Xcode Cloud](https://developer.apple.com/xcode-cloud/)
  * [SF Symbols](https://developer.apple.com/sf-symbols/)


###  Topics & Technologies 
Toggle Menu 
  * [Accessibility](https://developer.apple.com/accessibility/)
  * [Accessories](https://developer.apple.com/accessories/)
  * [App Extension](https://developer.apple.com/app-extensions/)
  * [App Store](https://developer.apple.com/app-store/)
  * [Audio & Video](https://developer.apple.com/audio/)
  * [Augmented Reality](https://developer.apple.com/augmented-reality/)
  * [Design](https://developer.apple.com/design/)
  * [Distribution](https://developer.apple.com/distribute/)
  * [Education](https://developer.apple.com/education/)
  * [Fonts](https://developer.apple.com/fonts/)
  * [Games](https://developer.apple.com/games/)
  * [Health & Fitness](https://developer.apple.com/health-fitness/)
  * [In-App Purchase](https://developer.apple.com/in-app-purchase/)
  * [Localization](https://developer.apple.com/localization/)
  * [Maps & Location](https://developer.apple.com/maps/)
  * [Machine Learning & AI](https://developer.apple.com/machine-learning/)
  * [Open Source](https://opensource.apple.com/)
  * [Security](https://developer.apple.com/security/)
  * [Safari & Web](https://developer.apple.com/safari/)


###  Resources 
Toggle Menu 
  *   * [Documentation](https://developer.apple.com/documentation/)
  * [Tutorials](https://developer.apple.com/learn/)
  * [Downloads](https://developer.apple.com/download/)
  * [Forums](https://developer.apple.com/forums/)
  * [Videos](https://developer.apple.com/videos/)


###  Support 
Toggle Menu 
  * [Support Articles](https://developer.apple.com/support/articles/)
  * [Contact Us](https://developer.apple.com/contact/)
  * [Bug Reporting](https://developer.apple.com/bug-reporting/)
  * [System Status](https://developer.apple.com/system-status/)


###  Account 
Toggle Menu 
  * [Apple Developer](https://developer.apple.com/account/)
  * [App Store Connect](https://appstoreconnect.apple.com/)
  * [Certificates, IDs, & Profiles](https://developer.apple.com/account/ios/certificate/)
  * [Feedback Assistant](https://feedbackassistant.apple.com/)


###  Programs 
Toggle Menu 
  * [Apple Developer Program](https://developer.apple.com/programs/)
  * [Apple Developer Enterprise Program](https://developer.apple.com/programs/enterprise/)
  * [App Store Small Business Program](https://developer.apple.com/app-store/small-business-program/)
  * [MFi Program](https://mfi.apple.com/)
  * [News Partner Program](https://developer.apple.com/programs/news-partner/)
  * [Video Partner Program](https://developer.apple.com/programs/video-partner/)
  * [Security Bounty Program](https://developer.apple.com/security-bounty/)
  * [Security Research Device Program](https://developer.apple.com/programs/security-research-device/)


###  Events 
Toggle Menu 
  * [Meet with Apple](https://developer.apple.com/events/)
  * [Apple Developer Centers](https://developer.apple.com/events/developer-centers/)
  * [App Store Awards](https://developer.apple.com/app-store/app-store-awards/)
  * [Apple Design Awards](https://developer.apple.com/design/awards/)
  * [Apple Developer Academies](https://developer.apple.com/academies/)
  * [WWDC](https://developer.apple.com/wwdc/)


To submit feedback on documentation, visit [Feedback Assistant](applefeedback://new?form_identifier=developertools.fba&answers%5B%3Aarea%5D=seedADC%3Adevpubs&answers%5B%3Adoc_type_req%5D=Technology%20Documentation&answers%5B%3Adocumentation_link_req%5D=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2FStoreKit%2Fdetermining-service-entitlement-on-the-server).
Select a color scheme preference
Light
Dark
Auto
Copyright © 2025 [Apple Inc.](https://www.apple.com) All rights reserved. 
[ Terms of Use ](https://www.apple.com/legal/internet-services/terms/site.html)[ Privacy Policy ](https://www.apple.com/legal/privacy/)[ Agreements and Guidelines ](https://developer.apple.com/support/terms/)
