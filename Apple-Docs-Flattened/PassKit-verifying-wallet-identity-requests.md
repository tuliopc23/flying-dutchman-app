Source: https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests

[ Skip Navigation ](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests#app-main)
  * [Global Nav Open Menu](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests#ac-gn-menustate)[Global Nav Close Menu](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests)
  * [Apple Developer](https://developer.apple.com/)


[ Search Developer Cancel  ](https://developer.apple.com/search/)
  * [Apple Developer](https://developer.apple.com/)
  * [News](https://developer.apple.com/news/)
  * [Discover](https://developer.apple.com/discover/)
  * [Design](https://developer.apple.com/design/)
  * [Develop](https://developer.apple.com/develop/)
  * [Distribute](https://developer.apple.com/distribute/)
  * [Support](https://developer.apple.com/support/)
  * [Account](https://developer.apple.com/account/)
  * [](https://developer.apple.com/search/)


Cancel 
Only search within “Documentation”
### Quick Links
  * [Downloads](https://developer.apple.com/download/)
  * [Documentation](https://developer.apple.com/documentation/)
  * [Sample Code](https://developer.apple.com/documentation/samplecode/)
  * [Videos](https://developer.apple.com/videos/)
  * [Forums](https://developer.apple.com/forums/)

5 Quick Links
[ Documentation ](https://developer.apple.com/documentation)
[ Open Menu ](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests)
  * SwiftLanguage:  Swift  Objective-C 
Language: 
    * Swift 
    * [ Objective-C ](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests)


[](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests)
## [ PassKit (Apple Pay and Wallet)  ](https://developer.apple.com/documentation/passkit)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
3 of 4 symbols inside <root>
Wallet support
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
4 of 4 symbols inside <root> containing 93 symbols[Wallet](https://developer.apple.com/documentation/passkit/wallet)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
1 of 93 symbols inside -993201791 
Essentials
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
T
2 of 93 symbols inside -993201791 [Pass Type IDs Entitlement](https://developer.apple.com/documentation/bundleresources/entitlements/com.apple.developer.pass-type-identifiers)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
T
3 of 93 symbols inside -993201791 [Merchant IDs Entitlement](https://developer.apple.com/documentation/bundleresources/entitlements/com.apple.developer.in-app-payments)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
4 of 93 symbols inside -993201791 [com.apple.developer.in-app-identity-presentment](https://developer.apple.com/documentation/bundleresources/entitlements/com.apple.developer.in-app-identity-presentment)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
5 of 93 symbols inside -993201791 [Requesting identity data from a Wallet pass](https://developer.apple.com/documentation/passkit/requesting-identity-data-from-a-wallet-pass)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
6 of 93 symbols inside -993201791 [Verifying Wallet identity requests](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
7 of 93 symbols inside -993201791 
Wallet Passes
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
8 of 93 symbols inside -993201791 [Wallet Passes](https://developer.apple.com/documentation/walletpasses)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
9 of 93 symbols inside -993201791 
Common data types
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
10 of 93 symbols inside -993201791 [PKObject](https://developer.apple.com/documentation/passkit/pkobject)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
11 of 93 symbols inside -993201791 containing 6 symbols[PKAddPassButton](https://developer.apple.com/documentation/passkit/pkaddpassbutton)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
12 of 93 symbols inside -993201791 containing 5 symbols[PKLabeledValue](https://developer.apple.com/documentation/passkit/pklabeledvalue)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
13 of 93 symbols inside -993201791 containing 14 symbols[AddPassToWalletButton](https://developer.apple.com/documentation/passkit/addpasstowalletbutton)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
14 of 93 symbols inside -993201791 containing 4 symbols[AddPassToWalletButtonFilter](https://developer.apple.com/documentation/passkit/addpasstowalletbuttonfilter)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
15 of 93 symbols inside -993201791 containing 4 symbols[AddPassToWalletButtonResponse](https://developer.apple.com/documentation/passkit/addpasstowalletbuttonresponse)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
16 of 93 symbols inside -993201791 containing 3 symbols[AddPassToWalletButtonStyle](https://developer.apple.com/documentation/passkit/addpasstowalletbuttonstyle)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
17 of 93 symbols inside -993201791 
Pass library
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
18 of 93 symbols inside -993201791 containing 42 symbols[PKPassLibrary](https://developer.apple.com/documentation/passkit/pkpasslibrary)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
19 of 93 symbols inside -993201791 
General purpose passes
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
20 of 93 symbols inside -993201791 containing 11 symbols[PKSecureElementPass](https://developer.apple.com/documentation/passkit/pksecureelementpass)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
21 of 93 symbols inside -993201791 containing 3 symbols[PKAddSecureElementPassConfiguration](https://developer.apple.com/documentation/passkit/pkaddsecureelementpassconfiguration)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
22 of 93 symbols inside -993201791 containing 7 symbols[PKAddSecureElementPassViewController](https://developer.apple.com/documentation/passkit/pkaddsecureelementpassviewcontroller)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
23 of 93 symbols inside -993201791 containing 28 symbols[PKPass](https://developer.apple.com/documentation/passkit/pkpass)
97 items were found. Tab back to navigate through them. 
/ 
Navigator is ready 
  * [ PassKit (Apple Pay and Wallet) ](https://developer.apple.com/documentation/passkit)
  * [ Wallet ](https://developer.apple.com/documentation/passkit/wallet)
  * [ Verifying Wallet identity requests ](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests)
  *     * [ Wallet ](https://developer.apple.com/documentation/passkit/wallet)
    * Verifying Wallet identity requests 


Article
# Verifying Wallet identity requests
Decrypt and verify an in-app presentment request on your server.
## [Overview](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests#overview)
Your server needs to decrypt and validate a mobile driver’s license (mDL) document that an app requests. The response contains the user information that you request, plus several security elements your server needs to validate the information to ensure it’s authentic.
### [Understand the response structure](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests#Understand-the-response-structure)
The `PassKit` framework uses the encryption certificate you create in the developer portal, so only your server can decrypt the response. The framework encrypts the data by using hybrid public key encryption (HPKE) that RFC 9180 defines.
The framework encodes the HPKE envelope and underlying plaintext with concise binary object representation (CBOR) — a binary JSON-like format that RFC 8949 defines. Because the framework encrypts the response data by using HPKE, it doesn’t use session encryption as ISO 18013-5 section 9.1.1 defines. The encryption envelope contains two parts, the encryption metadata and the encrypted data. When you decrypt the data, you get a CBOR-encoded data structure that contains an `mdoc` response object that ISO 18013-5 defines.
In HPKE, the `info` parameter — a session transcript — isn’t part of the package that you send. The sender and recipient need to build the `info` parameter independently, and need to generate the same value to successfully decrypt it. The following shows the HPKE envelope format:
```
HPKEEnvelope = {
    “algorithm”: tstr,    ; A value that's always “APPLE-HPKE-v1”.
    “params”: HPKEParams,
    “data”: bstr          ; The encrypted data.
}


HPKEParams = {
    “mode”: uint,         ; A value that's always 0.
    “pkEm”: bstr,         ; An ephemeral sender public key.
    “pkRHash”: bstr,      ; The SHA256 hash of the recipient public key.
    “infoHash”: bstr      ; The SHA256 hash of the HPKE info param.
}

```

The `infoHash` in the HPKE structure is the SHA256 hash of the session transcript during encryption to allow the recipient to verify they’re using the correct `info` parameter.
### [Build a session transcript](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests#Build-a-session-transcript)
The session transcript is a CBOR structure you use during decryption and during validation of the device signature. The session transcript allows you to validate that the response payload belongs to a specific request that your app makes.
Neither the session transcript nor the fields in it are part of the response payload. You need to create the structure on your server. Before you create the session transcript structure, verify that the hash of your public key matches the `pkRHash` property in the HPKE envelope.
The session transcript structure includes the same [`nonce`](https://developer.apple.com/documentation/passkit/pkidentityrequest/nonce) and merchant identifier you use in your [`PKIdentityRequest`](https://developer.apple.com/documentation/passkit/pkidentityrequest), a team identifier, and the SHA256 hash of the public key of the server’s decryption certificate. The session transcript values need to match your app and developer account.
The API uses a modified version of the `SessionTranscript` structure that ISO 18013-5 section 9.1.5.1 defines. The API doesn’t use `DeviceEngagementBytes` and `AReaderKeyBytes`, so those elements are `nil`. The handover element contains the `AppleHandover` structure, as the following code example shows:
```
SessionTranscript = [
    nil,           ; DeviceEngagementBytes isn't available.
    nil,           ; EReaderKeyBytes isn't available.        
    AppleHandover  ; A custom handover structure. 
]


AppleHandover = [
    “AppleIdentityPresentment_1.0”  ; The version number.
    nonce,                          ; The app-provided nonce you use.  
    merchantId,                     ; The merchant ID of the requesting client.  
    teamID,                         ; The team ID of the requesting client.
    pkRHash                         ; A SHA256 hash of the recipient public key, the same as in HPKEParams.
]

```

Compute the SHA256 hash of the session transcript to produce a value that matches the `infoHash` parameter in the HPKE envelope.
### [Decrypt the HPKE envelope](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests#Decrypt-the-HPKE-envelope)
Decryption requires the encrypted data parameter from the HPKE envelope, the session transcript you create, and your server’s private key. The private key needs to correspond to the encryption certificate you create in the developer portal. The info parameter is the session transcript. The `enc` parameter is the `pkEm` parameter in the HPKE envelope.
Use the inputs, along with the following HPKE options, to decrypt the encrypted data as the HPKE specification describes:
**Option** | **Value**  
---|---  
KEM | DHKEM(P-256, HKDF-SHA256)  
KDF | HKDF-SHA256  
AEAD | AES-128-GCM  
The output is a CBOR topics structure that wraps an ISO 18013-5 `mdoc` response structure.
```
Topics = {
    “identity”: DeviceResponse      ; A DeviceResponse structure.
}


DeviceResponse = {
    "version": tstr,                ; A value that's always 1.0.
    "documents": [+Document],       ; A list of documents with a length of 1.
    "status": uint,                 ; A value that's always 0.
}

```

The identity value contains the `DeviceResponse` structure that ISO 18013-5 section 8.2.2.1.2.2 defines.
An `mdoc` response contains three sections you use to verify that the response is valid. The issuer-signed items contain the elements your app requests. The issuer authentication structure contains the issuing authority’s signature and the metadata you use to verify the response authenticity. The device authentication structure contains a signature from the iPhone that’s requesting the information.
```
Document = {
    “docType”: DocType,                 ; The document type.
    “issuerSigned”: IssuerSigned,       ; The data elements the issuer signs.
    “deviceSigned”: DeviceSigned,       ; The data elements the mdoc signs.
    ? “errors”: Errors                 
}

```

Before using the elements, you need to verify they come from the issuer and device you expect.
### [Verify the issuer signature](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests#Verify-the-issuer-signature)
You use issuer data authentication to verify that the `mdoc` comes from an issuing authority you trust, and to verify it hasn’t been tampered with since issuance. Refer to ISO 18013-5 section 9.1.2 for more information.
The signed issuer structure includes the data elements you request, and an issuer authentication property that contains the mobile security object (MSO) you use for verification.
First, you need to verify that the user information in the response matches the data from the issuing authority. The issuer’s signature includes an array of digests, or hashes, covering every element in the mDL. There can be more digests than you see in the issuer-signed items structure because you only receive signed items for each element your app requests. Compute the digest for each signed item to make sure its digest is present in the issuer authentication.
Next, you use the issuer certificate to verify the issuer signature, and make sure the certificate matches an issuer root certificate your server trusts. The root certificates generally correspond to the issuing authorities of the state IDs you accept. For each state ID you accept, you need to download the root certificate from the corresponding state DMV website.
### [Verify the device signature](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests#Verify-the-device-signature)
The device authentication structure contains the signature of the device that’s requesting the information. Refer to ISO 18013-5 section 9.1.3 for more information.
Two mechanisms exist for `mdoc` authentication, ECDSA and MAC. The `PassKit` framework only uses ECDSA authentication. The session transcript you use to construct the device authentication structure is the same session transcript you use for decryption. Get the device signing key — represented as a `COSE_Key` — from the MSO.
### [Test the implementation](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests#Test-the-implementation)
After you verify the issuer signature and device signature, you can use the signed items as necessary. To download a sample that contains the files necessary to test your implementation, see [Apple Wallet Developer Resources](https://developer.apple.com/wallet/resources/).
## [See Also](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests#see-also)
### [Essentials](https://developer.apple.com/documentation/passkit/verifying-wallet-identity-requests#Essentials)
[`Pass Type IDs Entitlement`](https://developer.apple.com/documentation/BundleResources/Entitlements/com.apple.developer.pass-type-identifiers)
A list of identifiers that specify pass types that your app can access in Wallet.
[`Merchant IDs Entitlement`](https://developer.apple.com/documentation/BundleResources/Entitlements/com.apple.developer.in-app-payments)
A list of merchant IDs your app uses for Apple Pay support.
[`com.apple.developer.in-app-identity-presentment`](https://developer.apple.com/documentation/BundleResources/Entitlements/com.apple.developer.in-app-identity-presentment)
An entitlement that verifies age or identity.
[Requesting identity data from a Wallet pass](https://developer.apple.com/documentation/passkit/requesting-identity-data-from-a-wallet-pass)
Initiate a request for identity information by prompting a user for permission and decrypting a response payload.
Current page is Verifying Wallet identity requests 
[Apple](https://www.apple.com)
  1. [Developer](https://developer.apple.com/)
  2. [ Documentation ](https://developer.apple.com/documentation/)


###  Platforms 
Toggle Menu 
  * [iOS](https://developer.apple.com/ios/)
  * [iPadOS](https://developer.apple.com/ipados/)
  * [macOS](https://developer.apple.com/macos/)
  * [tvOS](https://developer.apple.com/tvos/)
  * [visionOS](https://developer.apple.com/visionos/)
  * [watchOS](https://developer.apple.com/watchos/)


###  Tools 
Toggle Menu 
  * [Swift](https://developer.apple.com/swift/)
  * [SwiftUI](https://developer.apple.com/swiftui/)
  * [Swift Playground](https://developer.apple.com/swift-playground/)
  * [TestFlight](https://developer.apple.com/testflight/)
  * [Xcode](https://developer.apple.com/xcode/)
  * [Xcode Cloud](https://developer.apple.com/xcode-cloud/)
  * [SF Symbols](https://developer.apple.com/sf-symbols/)


###  Topics & Technologies 
Toggle Menu 
  * [Accessibility](https://developer.apple.com/accessibility/)
  * [Accessories](https://developer.apple.com/accessories/)
  * [App Extension](https://developer.apple.com/app-extensions/)
  * [App Store](https://developer.apple.com/app-store/)
  * [Audio & Video](https://developer.apple.com/audio/)
  * [Augmented Reality](https://developer.apple.com/augmented-reality/)
  * [Design](https://developer.apple.com/design/)
  * [Distribution](https://developer.apple.com/distribute/)
  * [Education](https://developer.apple.com/education/)
  * [Fonts](https://developer.apple.com/fonts/)
  * [Games](https://developer.apple.com/games/)
  * [Health & Fitness](https://developer.apple.com/health-fitness/)
  * [In-App Purchase](https://developer.apple.com/in-app-purchase/)
  * [Localization](https://developer.apple.com/localization/)
  * [Maps & Location](https://developer.apple.com/maps/)
  * [Machine Learning & AI](https://developer.apple.com/machine-learning/)
  * [Open Source](https://opensource.apple.com/)
  * [Security](https://developer.apple.com/security/)
  * [Safari & Web](https://developer.apple.com/safari/)


###  Resources 
Toggle Menu 
  *   * [Documentation](https://developer.apple.com/documentation/)
  * [Tutorials](https://developer.apple.com/learn/)
  * [Downloads](https://developer.apple.com/download/)
  * [Forums](https://developer.apple.com/forums/)
  * [Videos](https://developer.apple.com/videos/)


###  Support 
Toggle Menu 
  * [Support Articles](https://developer.apple.com/support/articles/)
  * [Contact Us](https://developer.apple.com/contact/)
  * [Bug Reporting](https://developer.apple.com/bug-reporting/)
  * [System Status](https://developer.apple.com/system-status/)


###  Account 
Toggle Menu 
  * [Apple Developer](https://developer.apple.com/account/)
  * [App Store Connect](https://appstoreconnect.apple.com/)
  * [Certificates, IDs, & Profiles](https://developer.apple.com/account/ios/certificate/)
  * [Feedback Assistant](https://feedbackassistant.apple.com/)


###  Programs 
Toggle Menu 
  * [Apple Developer Program](https://developer.apple.com/programs/)
  * [Apple Developer Enterprise Program](https://developer.apple.com/programs/enterprise/)
  * [App Store Small Business Program](https://developer.apple.com/app-store/small-business-program/)
  * [MFi Program](https://mfi.apple.com/)
  * [News Partner Program](https://developer.apple.com/programs/news-partner/)
  * [Video Partner Program](https://developer.apple.com/programs/video-partner/)
  * [Security Bounty Program](https://developer.apple.com/security-bounty/)
  * [Security Research Device Program](https://developer.apple.com/programs/security-research-device/)


###  Events 
Toggle Menu 
  * [Meet with Apple](https://developer.apple.com/events/)
  * [Apple Developer Centers](https://developer.apple.com/events/developer-centers/)
  * [App Store Awards](https://developer.apple.com/app-store/app-store-awards/)
  * [Apple Design Awards](https://developer.apple.com/design/awards/)
  * [Apple Developer Academies](https://developer.apple.com/academies/)
  * [WWDC](https://developer.apple.com/wwdc/)


To submit feedback on documentation, visit [Feedback Assistant](applefeedback://new?form_identifier=developertools.fba&answers%5B%3Aarea%5D=seedADC%3Adevpubs&answers%5B%3Adoc_type_req%5D=Technology%20Documentation&answers%5B%3Adocumentation_link_req%5D=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fpasskit%2Fverifying-wallet-identity-requests).
Select a color scheme preference
Light
Dark
Auto
Copyright © 2025 [Apple Inc.](https://www.apple.com) All rights reserved. 
[ Terms of Use ](https://www.apple.com/legal/internet-services/terms/site.html)[ Privacy Policy ](https://www.apple.com/legal/privacy/)[ Agreements and Guidelines ](https://developer.apple.com/support/terms/)
