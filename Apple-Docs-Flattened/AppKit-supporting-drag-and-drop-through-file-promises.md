Source: https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises

[ Skip Navigation ](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises#app-main)
  * [Global Nav Open Menu](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises#ac-gn-menustate)[Global Nav Close Menu](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises)
  * [Apple Developer](https://developer.apple.com/)


[ Search Developer Cancel  ](https://developer.apple.com/search/)
  * [Apple Developer](https://developer.apple.com/)
  * [News](https://developer.apple.com/news/)
  * [Discover](https://developer.apple.com/discover/)
  * [Design](https://developer.apple.com/design/)
  * [Develop](https://developer.apple.com/develop/)
  * [Distribute](https://developer.apple.com/distribute/)
  * [Support](https://developer.apple.com/support/)
  * [Account](https://developer.apple.com/account/)
  * [](https://developer.apple.com/search/)


Cancel 
Only search within “Documentation”
### Quick Links
  * [Downloads](https://developer.apple.com/download/)
  * [Documentation](https://developer.apple.com/documentation/)
  * [Sample Code](https://developer.apple.com/documentation/samplecode/)
  * [Videos](https://developer.apple.com/videos/)
  * [Forums](https://developer.apple.com/forums/)

5 Quick Links
[ Documentation ](https://developer.apple.com/documentation)
[ Open Menu ](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises)
  * SwiftLanguage:  Swift  Objective-C 
Language: 
    * Swift 
    * [ Objective-C ](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises)


[](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises)
## [ AppKit  ](https://developer.apple.com/documentation/appkit)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
10 of 44 symbols inside <root> containing 8 symbols[Resource Management](https://developer.apple.com/documentation/appkit/resource-management)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
10 of 26 symbols inside 955518975 containing 59 symbols[NSPasteboard](https://developer.apple.com/documentation/appkit/nspasteboard)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
11 of 26 symbols inside 955518975 containing 21 symbols[NSPasteboardItem](https://developer.apple.com/documentation/appkit/nspasteboarditem)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
12 of 26 symbols inside 955518975 containing 6 symbols[NSPasteboardReading](https://developer.apple.com/documentation/appkit/nspasteboardreading)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
13 of 26 symbols inside 955518975 containing 9 symbols[NSPasteboardWriting](https://developer.apple.com/documentation/appkit/nspasteboardwriting)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
14 of 26 symbols inside 955518975 containing 3 symbols[NSPasteboardItemDataProvider](https://developer.apple.com/documentation/appkit/nspasteboarditemdataprovider)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
15 of 26 symbols inside 955518975 containing 4 symbols[NSPasteboard.ContentsOptions](https://developer.apple.com/documentation/appkit/nspasteboard/contentsoptions)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
16 of 26 symbols inside 955518975 containing 4 symbols[NSPasteboardTypeOwner](https://developer.apple.com/documentation/appkit/nspasteboardtypeowner)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
17 of 26 symbols inside 955518975 
File Promises
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
18 of 26 symbols inside 955518975 [Supporting Drag and Drop Through File Promises](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
19 of 26 symbols inside 955518975 [Supporting Table View Drag and Drop Through File Promises](https://developer.apple.com/documentation/appkit/supporting-table-view-drag-and-drop-through-file-promises)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
20 of 26 symbols inside 955518975 [Supporting Collection View Drag and Drop Through File Promises](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
21 of 26 symbols inside 955518975 containing 7 symbols[NSFilePromiseProvider](https://developer.apple.com/documentation/appkit/nsfilepromiseprovider)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
22 of 26 symbols inside 955518975 containing 4 symbols[NSFilePromiseProviderDelegate](https://developer.apple.com/documentation/appkit/nsfilepromiseproviderdelegate)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
23 of 26 symbols inside 955518975 containing 7 symbols[NSFilePromiseReceiver](https://developer.apple.com/documentation/appkit/nsfilepromisereceiver)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
24 of 26 symbols inside 955518975 
Object Editing
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
25 of 26 symbols inside 955518975 containing 5 symbols[NSEditor](https://developer.apple.com/documentation/appkit/nseditor)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
26 of 26 symbols inside 955518975 containing 3 symbols[NSEditorRegistration](https://developer.apple.com/documentation/appkit/nseditorregistration)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
9 of 44 symbols inside <root> containing 21 symbols[Cocoa Bindings](https://developer.apple.com/documentation/appkit/cocoa-bindings)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
10 of 44 symbols inside <root> containing 8 symbols[Resource Management](https://developer.apple.com/documentation/appkit/resource-management)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
11 of 44 symbols inside <root> containing 19 symbols[App Extensions](https://developer.apple.com/documentation/appkit/app-extensions)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
12 of 44 symbols inside <root>
User Interface
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
13 of 44 symbols inside <root> containing 60 symbols[Views and Controls](https://developer.apple.com/documentation/appkit/views-and-controls)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
14 of 44 symbols inside <root> containing 18 symbols[View Management](https://developer.apple.com/documentation/appkit/view-management)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
15 of 44 symbols inside <root> containing 13 symbols[View Layout](https://developer.apple.com/documentation/appkit/view-layout)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
16 of 44 symbols inside <root> containing 5 symbols[Appearance Customization](https://developer.apple.com/documentation/appkit/appearance-customization)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
17 of 44 symbols inside <root> containing 11 symbols[Animation](https://developer.apple.com/documentation/appkit/animation)
70 items were found. Tab back to navigate through them. 
/ 
Navigator is ready 
  * [ AppKit ](https://developer.apple.com/documentation/appkit)
  * [ Documents, Data, and Pasteboard ](https://developer.apple.com/documentation/appkit/documents-data-and-pasteboard)
  * [ Supporting Drag and Drop Through File Promises ](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises)
  *     * [ Documents, Data, and Pasteboard ](https://developer.apple.com/documentation/appkit/documents-data-and-pasteboard)
    * Supporting Drag and Drop Through File Promises 


Sample Code
# Supporting Drag and Drop Through File Promises
Receive and provide file promises to support dragged app files and pasteboard operations.
[ Download ](https://docs-assets.developer.apple.com/published/d25f50af13b3/SupportingDragAndDropThroughFilePromises.zip)
macOS 10.15+Xcode 13.3+
## [Overview](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises#Overview)
This sample code project creates a meme generator that combines an image and text into a composite meme image which can be exported as a JPEG. The sample shows you how to support both file URLs and file promises when accepting images from Mail, Safari, Photos, and other apps that support drag and drop. It also demonstrates how to provide file promises to other apps.
Your app may need to support file promises because drag and drop on macOS uses an NSPasteboard, which is separate from the normal copy-and-paste clipboard. When dragging content that isnʼt yet a file on disk at the time dragging began, an app may put a file promise onto the pasteboard instead of a file URL, to avoid blocking the main thread. File promises are different from URLs because they can be read and written asynchronously at a later time, on a background queue separate from the main queue. macOS Sierra introduced modern APIs to handle file promises.
### [Configure the Sample Code Project](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises#Configure-the-Sample-Code-Project)
To see this sample in action, build and run the project, then drag an image from another app or location, such as Finder, Mail, or Safari, into the app window. Dragging the image into the window imports it into a form the sample app can parse and consume. Add text to the image by clicking on the text button in the upper-right corner and typing. Reposition the text box by dragging and dropping it within the app window. Dragging the composite image outside the app window exports it as a JPEG.
Below are the various ways a drag and drop can occur that will involve either a `NSFilePromiseProvider` or a `NSFilePromiseReceiver`.
Drag sent by `NSFilePromiseProvider`:
  * Drag an image out to the Finder.
  * Drag an image out to Mail.
  * Drag an image out to Photos.


Drag received by `NSFilePromiseReceiver`:
  * Drag an image in from Safari (from a website with a jpg, png, etc).
  * Drag an image in from Photos.
  * Drag in a very large photo from Photos app — helps test the progress UI when receiving large photos.


In addition, a drag and drop involves just the image file’s URL, without a file promise:
  * Drag an image from Finder.
  * Drag an image from a Mail attachment.


### [Support Image Import by Accepting File Promises](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises#Support-Image-Import-by-Accepting-File-Promises)
When setting up the view that supports drag and drop, register drag types provided by [`NSFilePromiseReceiver`](https://developer.apple.com/documentation/appkit/nsfilepromisereceiver). This registration allows the view to accept file promises that handle dragged images from Safari or Mail. The sample does this in the first view controller’s `viewDidLoad`.
```
view.registerForDraggedTypes(NSFilePromiseReceiver.readableDraggedTypes.map { NSPasteboard.PasteboardType($0) })

```

Handle file promises before handling URLs, because the file promise generally represents the higher-quality image and should take precedence when both types are supported. This sample provides a background operation queue, so the read/write operation doesn’t block the main thread. Until the file promise is fulfilled, this sample shows a spinner or loading indicator in the image view subclass to give the user immediate feedback that the app is processing the drop.
```
case let filePromiseReceiver as NSFilePromiseReceiver:
    self.prepareForUpdate()
    filePromiseReceiver.receivePromisedFiles(atDestination: self.destinationURL, options: [:],
                                             operationQueue: self.workQueue) { (fileURL, error) in
        if let error = error {
            self.handleError(error)
        } else {
            self.handleFile(at: fileURL)
        }
    }

```

This sample continues to handle file URLs, in case the app from which a user drags the image doesn’t provide file promises.
```
case let fileURL as URL:
    self.handleFile(at: fileURL)

```

### [Support Image Export by Providing File Promises](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises#Support-Image-Export-by-Providing-File-Promises)
This sample creates and writes images into formats that other apps like Safari, Mail, and Finder can consume. It does this by providing an [`NSFilePromiseProvider`](https://developer.apple.com/documentation/appkit/nsfilepromiseprovider) instance to the dragging pasteboard and conforming to [`NSFilePromiseProviderDelegate`](https://developer.apple.com/documentation/appkit/nsfilepromiseproviderdelegate) by implementing three delegate methods.
This sample uses the first method to provide the title of the file. It uses a hard-coded string for simplicity, but depending on use case, take the `fileType` parameter into account.
```
func filePromiseProvider(_ filePromiseProvider: NSFilePromiseProvider, fileNameForType fileType: String) -> String {
    let droppedFileName = NSLocalizedString("DropFileTitle", comment: "")
    return droppedFileName + ".jpg"
}

```

This sample provides a background operation queue in [`operationQueue(for:)`](https://developer.apple.com/documentation/appkit/nsfilepromiseproviderdelegate/operationqueue\(for:\)) so the file reading and writing happen without blocking the app’s UI. This method is optional, but defaulting to the main queue can block an app’s UI for writing large files to disk. When possible, provide a background queue.
```
func operationQueue(for filePromiseProvider: NSFilePromiseProvider) -> OperationQueue {
    return workQueue
}

```

The third delegate method performs the actual writing of the file to disk when it’s time to fulfill the file promise. Add custom logic necessary to transform the image from your app into a file format that other apps are likely to understand, such as the JPEG format this sample uses.
```
func filePromiseProvider(_ filePromiseProvider: NSFilePromiseProvider, writePromiseTo url: URL, completionHandler: @escaping (Error?) -> Void) {
    do {
        if let snapshot = filePromiseProvider.userInfo as? ImageCanvas.SnapshotItem {
            try snapshot.jpegRepresentation?.write(to: url)
        } else {
            throw RuntimeError.unavailableSnapshot
        }
        completionHandler(nil)
    } catch let error {
        completionHandler(error)
    }
}

```

## [See Also](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises#see-also)
### [File Promises](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises#File-Promises)
[Supporting Table View Drag and Drop Through File Promises](https://developer.apple.com/documentation/appkit/supporting-table-view-drag-and-drop-through-file-promises)
Share data between macOS apps during drag and drop by using an item provider.
[Supporting Collection View Drag and Drop Through File Promises](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises)
Share data between macOS apps during drag and drop by using an item provider.
[`class NSFilePromiseProvider`](https://developer.apple.com/documentation/appkit/nsfilepromiseprovider)
An object that provides a promise for the pasteboard.
[`protocol NSFilePromiseProviderDelegate`](https://developer.apple.com/documentation/appkit/nsfilepromiseproviderdelegate)
A set of methods that provides the name of the promised file and writes the file to the destination directory when the file promise is fulfilled.
[`class NSFilePromiseReceiver`](https://developer.apple.com/documentation/appkit/nsfilepromisereceiver)
An object that receives a file promise from the pasteboard.
Current page is Supporting Drag and Drop Through File Promises 
[Apple](https://www.apple.com)
  1. [Developer](https://developer.apple.com/)
  2. [ Documentation ](https://developer.apple.com/documentation/)


###  Platforms 
Toggle Menu 
  * [iOS](https://developer.apple.com/ios/)
  * [iPadOS](https://developer.apple.com/ipados/)
  * [macOS](https://developer.apple.com/macos/)
  * [tvOS](https://developer.apple.com/tvos/)
  * [visionOS](https://developer.apple.com/visionos/)
  * [watchOS](https://developer.apple.com/watchos/)


###  Tools 
Toggle Menu 
  * [Swift](https://developer.apple.com/swift/)
  * [SwiftUI](https://developer.apple.com/swiftui/)
  * [Swift Playground](https://developer.apple.com/swift-playground/)
  * [TestFlight](https://developer.apple.com/testflight/)
  * [Xcode](https://developer.apple.com/xcode/)
  * [Xcode Cloud](https://developer.apple.com/xcode-cloud/)
  * [SF Symbols](https://developer.apple.com/sf-symbols/)


###  Topics & Technologies 
Toggle Menu 
  * [Accessibility](https://developer.apple.com/accessibility/)
  * [Accessories](https://developer.apple.com/accessories/)
  * [App Extension](https://developer.apple.com/app-extensions/)
  * [App Store](https://developer.apple.com/app-store/)
  * [Audio & Video](https://developer.apple.com/audio/)
  * [Augmented Reality](https://developer.apple.com/augmented-reality/)
  * [Design](https://developer.apple.com/design/)
  * [Distribution](https://developer.apple.com/distribute/)
  * [Education](https://developer.apple.com/education/)
  * [Fonts](https://developer.apple.com/fonts/)
  * [Games](https://developer.apple.com/games/)
  * [Health & Fitness](https://developer.apple.com/health-fitness/)
  * [In-App Purchase](https://developer.apple.com/in-app-purchase/)
  * [Localization](https://developer.apple.com/localization/)
  * [Maps & Location](https://developer.apple.com/maps/)
  * [Machine Learning & AI](https://developer.apple.com/machine-learning/)
  * [Open Source](https://opensource.apple.com/)
  * [Security](https://developer.apple.com/security/)
  * [Safari & Web](https://developer.apple.com/safari/)


###  Resources 
Toggle Menu 
  *   * [Documentation](https://developer.apple.com/documentation/)
  * [Tutorials](https://developer.apple.com/learn/)
  * [Downloads](https://developer.apple.com/download/)
  * [Forums](https://developer.apple.com/forums/)
  * [Videos](https://developer.apple.com/videos/)


###  Support 
Toggle Menu 
  * [Support Articles](https://developer.apple.com/support/articles/)
  * [Contact Us](https://developer.apple.com/contact/)
  * [Bug Reporting](https://developer.apple.com/bug-reporting/)
  * [System Status](https://developer.apple.com/system-status/)


###  Account 
Toggle Menu 
  * [Apple Developer](https://developer.apple.com/account/)
  * [App Store Connect](https://appstoreconnect.apple.com/)
  * [Certificates, IDs, & Profiles](https://developer.apple.com/account/ios/certificate/)
  * [Feedback Assistant](https://feedbackassistant.apple.com/)


###  Programs 
Toggle Menu 
  * [Apple Developer Program](https://developer.apple.com/programs/)
  * [Apple Developer Enterprise Program](https://developer.apple.com/programs/enterprise/)
  * [App Store Small Business Program](https://developer.apple.com/app-store/small-business-program/)
  * [MFi Program](https://mfi.apple.com/)
  * [News Partner Program](https://developer.apple.com/programs/news-partner/)
  * [Video Partner Program](https://developer.apple.com/programs/video-partner/)
  * [Security Bounty Program](https://developer.apple.com/security-bounty/)
  * [Security Research Device Program](https://developer.apple.com/programs/security-research-device/)


###  Events 
Toggle Menu 
  * [Meet with Apple](https://developer.apple.com/events/)
  * [Apple Developer Centers](https://developer.apple.com/events/developer-centers/)
  * [App Store Awards](https://developer.apple.com/app-store/app-store-awards/)
  * [Apple Design Awards](https://developer.apple.com/design/awards/)
  * [Apple Developer Academies](https://developer.apple.com/academies/)
  * [WWDC](https://developer.apple.com/wwdc/)


To submit feedback on documentation, visit [Feedback Assistant](applefeedback://new?form_identifier=developertools.fba&answers%5B%3Aarea%5D=seedADC%3Adevpubs&answers%5B%3Adoc_type_req%5D=Technology%20Documentation&answers%5B%3Adocumentation_link_req%5D=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fappkit%2Fsupporting-drag-and-drop-through-file-promises).
Select a color scheme preference
Light
Dark
Auto
Copyright © 2025 [Apple Inc.](https://www.apple.com) All rights reserved. 
[ Terms of Use ](https://www.apple.com/legal/internet-services/terms/site.html)[ Privacy Policy ](https://www.apple.com/legal/privacy/)[ Agreements and Guidelines ](https://developer.apple.com/support/terms/)
