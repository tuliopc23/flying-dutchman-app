Source: https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes

[ Skip Navigation ](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes#app-main)
  * [Global Nav Open Menu](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes#ac-gn-menustate)[Global Nav Close Menu](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes)
  * [Apple Developer](https://developer.apple.com/)


[ Search Developer Cancel  ](https://developer.apple.com/search/)
  * [Apple Developer](https://developer.apple.com/)
  * [News](https://developer.apple.com/news/)
  * [Discover](https://developer.apple.com/discover/)
  * [Design](https://developer.apple.com/design/)
  * [Develop](https://developer.apple.com/develop/)
  * [Distribute](https://developer.apple.com/distribute/)
  * [Support](https://developer.apple.com/support/)
  * [Account](https://developer.apple.com/account/)
  * [](https://developer.apple.com/search/)


Cancel 
Only search within “Documentation”
### Quick Links
  * [Downloads](https://developer.apple.com/download/)
  * [Documentation](https://developer.apple.com/documentation/)
  * [Sample Code](https://developer.apple.com/documentation/samplecode/)
  * [Videos](https://developer.apple.com/videos/)
  * [Forums](https://developer.apple.com/forums/)

5 Quick Links
[ Documentation ](https://developer.apple.com/documentation)
[ Open Menu ](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes)
  * SwiftLanguage:  Swift  Objective-C 
Language: 
    * Swift 
    * [ Objective-C ](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes)


[](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes)
## [ Core Data  ](https://developer.apple.com/documentation/coredata)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
34 of 37 symbols inside <root> containing 7 symbols[Staged migrations](https://developer.apple.com/documentation/coredata/staged-migrations)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
17 of 37 symbols inside <root>
CloudKit mirroring
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
18 of 37 symbols inside <root> containing 5 symbols[Mirroring a Core Data store with CloudKit](https://developer.apple.com/documentation/coredata/mirroring-a-core-data-store-with-cloudkit)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
19 of 37 symbols inside <root> [Synchronizing a local store to the cloud](https://developer.apple.com/documentation/coredata/synchronizing-a-local-store-to-the-cloud)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
20 of 37 symbols inside <root> containing 16 symbols[NSPersistentCloudKitContainer](https://developer.apple.com/documentation/coredata/nspersistentcloudkitcontainer)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
21 of 37 symbols inside <root> containing 4 symbols[NSPersistentCloudKitContainerOptions](https://developer.apple.com/documentation/coredata/nspersistentcloudkitcontaineroptions)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
22 of 37 symbols inside <root> [Sharing Core Data objects between iCloud users](https://developer.apple.com/documentation/coredata/sharing-core-data-objects-between-icloud-users)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
23 of 37 symbols inside <root>
Change processing
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
24 of 37 symbols inside <root> [Accessing data when the store changes](https://developer.apple.com/documentation/coredata/accessing-data-when-the-store-changes)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
25 of 37 symbols inside <root> [Consuming relevant store changes](https://developer.apple.com/documentation/coredata/consuming-relevant-store-changes)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
26 of 37 symbols inside <root> containing 8 symbols[Persistent history](https://developer.apple.com/documentation/coredata/persistent-history)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
27 of 37 symbols inside <root>
Background tasks
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
28 of 37 symbols inside <root> [Using Core Data in the background](https://developer.apple.com/documentation/coredata/using-core-data-in-the-background)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
29 of 37 symbols inside <root> [Loading and displaying a large data feed](https://developer.apple.com/documentation/swiftui/loading-and-displaying-a-large-data-feed)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
30 of 37 symbols inside <root> containing 5 symbols[Conflict resolution](https://developer.apple.com/documentation/coredata/conflict-resolution)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
31 of 37 symbols inside <root> containing 9 symbols[Batch processing](https://developer.apple.com/documentation/coredata/batch-processing)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
32 of 37 symbols inside <root>
Data model migration
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
33 of 37 symbols inside <root> [Migrating your data model automatically](https://developer.apple.com/documentation/coredata/migrating-your-data-model-automatically)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
34 of 37 symbols inside <root> containing 7 symbols[Staged migrations](https://developer.apple.com/documentation/coredata/staged-migrations)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
35 of 37 symbols inside <root> containing 7 symbols[Manual migrations](https://developer.apple.com/documentation/coredata/manual-migrations)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
36 of 37 symbols inside <root>
Related types
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
37 of 37 symbols inside <root> containing 60 symbols[Core Data Constants](https://developer.apple.com/documentation/coredata/core-data-constants)
37 items were found. Tab back to navigate through them. 
/ 
Navigator is ready 
  * [ Core Data ](https://developer.apple.com/documentation/coredata)
  * [ Accessing data when the store changes ](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes)
  *     * Accessing data when the store changes 


Article
# Accessing data when the store changes
Guarantee that a context won’t see store changes until you tell it to look.
## [Overview](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes#overview)
Query generations give your UI a stable view of data in the database, regardless of changes happening to the store underneath. Whenever you read from a context, you see the same generation, or snapshot, of data until you choose to advance it to a later generation.
Use query generations when you want to isolate your view context from any changes made in the store by background threads in your app, app extensions, CloudKit, or other sources.
### [Ensure the correct type and mode for the persistent store](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes#Ensure-the-correct-type-and-mode-for-the-persistent-store)
To use query generations, the persistent store must be an [`NSSQLiteStoreType`](https://developer.apple.com/documentation/coredata/nssqlitestoretype) in write-ahead logging (WAL) journal mode. Core Data creates SQLite stores with WAL mode enabled by default.
Query generations leverage WAL mode to let you query against the historical state of the database. Core Data appends transactions to a `.sqlite-wal` file, or journal, in the same directory as the main store file. When your context reads from the journal, it starts at the transaction associated with a specific generation, instead of at the most recent transaction.
To confirm whether a custom store has WAL mode enabled, turn on SQL logging. Choose Product > Scheme > Edit Scheme, then choose the Run action, and add the following line under Arguments Passed on Launch:
```
-com.apple.CoreData.SQLDebug 1

```

Run your app, and look for the following output in the console:
```
CoreData: sql: pragma journal_mode=wal

```

If you try to use query generations with a store that’s not an [`NSSQLiteStoreType`](https://developer.apple.com/documentation/coredata/nssqlitestoretype) in WAL journal mode, your contexts gracefully revert to unpinned behavior.
### [Pin the context to a store generation](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes#Pin-the-context-to-a-store-generation)
By default, contexts are unpinned, and read from the store at the generation of the most recent transaction. Pinned contexts read from the store at the generation of a specific transaction.
To pin a context, call [`setQueryGenerationFrom(_:)`](https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext/setquerygenerationfrom\(_:\)) and pass an opaque [`NSQueryGenerationToken`](https://developer.apple.com/documentation/coredata/nsquerygenerationtoken). The context updates to the specified generation lazily on the next read (fetching or faulting) operation.
Use the [`current`](https://developer.apple.com/documentation/coredata/nsquerygenerationtoken/current) generation token to pin the context to the generation corresponding to the most recent store transaction. For example, pass the [`current`](https://developer.apple.com/documentation/coredata/nsquerygenerationtoken/current) generation token when setting up your stack to pin the view context to the first generation that it fetches.
```
// Pin the context to the generation that corresponds with the most recent
// store transaction.
do {
    try persistentContainer.viewContext.setQueryGenerationFrom(.current)
} catch {
    // Handle the error appropriately.
    print("Failed to pin the context:", error.localizedDescription)
}

```

Alternatively, use the [`queryGenerationToken`](https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext/querygenerationtoken) from another pinned context to align both contexts to the same generation.
To unpin a context, call [`setQueryGenerationFrom(_:)`](https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext/setquerygenerationfrom\(_:\)), passing `nil`.
```
// Unpin the context.
do {
    try persistentContainer.viewContext.setQueryGenerationFrom(nil)
} catch {
    // Handle the error appropriately.
    print("Failed to unpin the context:", error.localizedDescription)
}

```

Nested contexts inherit their parent’s generation. They’re implicitly unpinned, but they see data as viewed through the generation of their parent with the addition of their parent’s pending changes.
A generation doesn’t include stores added to the store coordinator after the generation’s creation. Additionally, if you remove a store from the coordinator, don’t try to load data from the deleted store into a context.
### [Update the view context to the current store generation](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes#Update-the-view-context-to-the-current-store-generation)
Advance a context to the generation of the most recent transaction, and pin it there, by calling [`setQueryGenerationFrom(_:)`](https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext/setquerygenerationfrom\(_:\)) and passing the [`current`](https://developer.apple.com/documentation/coredata/nsquerygenerationtoken/current) token. The context updates to the specified generation lazily on the next read (fetching or faulting) operation.
```
// Advance the context to the generation of the most recent store transaction.
do {
    try persistentContainer.viewContext.setQueryGenerationFrom(.current)
} catch {
    // Handle the error appropriately.
    print("Failed to set the query generation:", error.localizedDescription)
}

```

Alternatively, update a context’s generation by calling any of the following.
  * [`setQueryGenerationFrom(_:)`](https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext/setquerygenerationfrom\(_:\))
  * [`save()`](https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext/save\(\))
  * [`mergeChanges(fromContextDidSave:)`](https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext/mergechanges\(fromcontextdidsave:\))
  * [`mergeChanges(fromRemoteContextSave:into:)`](https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext/mergechanges\(fromremotecontextsave:into:\))
  * [`reset()`](https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext/reset\(\))


Update contexts to the [`current`](https://developer.apple.com/documentation/coredata/nsquerygenerationtoken/current) generation as soon as a specific generation is no longer needed. Query generations hold a file lock open to maintain the integrity of the journal for the duration of a query generation. Once no contexts refer to a query generation, it expires, and the system can reclaim the journal disk space.
### [Refresh objects](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes#Refresh-objects)
Refresh any managed objects registered to the context after you change the context’s query generation or unpin the context. Managed objects don’t automatically refresh, as this behavior may not be desirable and is difficult to revert.
Call [`refreshAllObjects()`](https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext/refreshallobjects\(\)) on the context to refresh its existing managed objects.
```
// Refresh existing managed objects.
persistentContainer.viewContext.refreshAllObjects()

```

You can also refresh your objects by fetching them again. Call [`fetch(_:)`](https://developer.apple.com/documentation/coredata/nsmanagedobjectcontext/fetch\(_:\)-4xeoz) on the context to retrieve a fresh set of managed objects matching your request criteria.
```
// Alternatively, refresh objects by fetching them again.
let request = NSFetchRequest<ShoppingItem>(entityName: "ShoppingItem")
request.fetchBatchSize = 10


// Execute the fetch.
let results = await persistentContainer.viewContext.perform {
    do {
        return try self.persistentContainer.viewContext.fetch(request)
    } catch {
        // Handle the error appropriately. It's useful to use
        // `fatalError(_:file:line:)` during development.
        fatalError("Failed to refresh the objects: \(error.localizedDescription)")
    }
}

```

The fetch reads the journal from the context’s query generation if pinned, or from the most recent transaction if unpinned.
## [See Also](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes#see-also)
### [Change processing](https://developer.apple.com/documentation/CoreData/accessing-data-when-the-store-changes#Change-processing)
[Consuming relevant store changes](https://developer.apple.com/documentation/coredata/consuming-relevant-store-changes)
Filter store transactions for changes relevant to the current view.
[API Reference Persistent history](https://developer.apple.com/documentation/coredata/persistent-history)
Use persistent history tracking to determine what changes have occurred in the store since the enabling of persistent history tracking.
Current page is Accessing data when the store changes 
[Apple](https://www.apple.com)
  1. [Developer](https://developer.apple.com/)
  2. [ Documentation ](https://developer.apple.com/documentation/)


###  Platforms 
Toggle Menu 
  * [iOS](https://developer.apple.com/ios/)
  * [iPadOS](https://developer.apple.com/ipados/)
  * [macOS](https://developer.apple.com/macos/)
  * [tvOS](https://developer.apple.com/tvos/)
  * [visionOS](https://developer.apple.com/visionos/)
  * [watchOS](https://developer.apple.com/watchos/)


###  Tools 
Toggle Menu 
  * [Swift](https://developer.apple.com/swift/)
  * [SwiftUI](https://developer.apple.com/swiftui/)
  * [Swift Playground](https://developer.apple.com/swift-playground/)
  * [TestFlight](https://developer.apple.com/testflight/)
  * [Xcode](https://developer.apple.com/xcode/)
  * [Xcode Cloud](https://developer.apple.com/xcode-cloud/)
  * [SF Symbols](https://developer.apple.com/sf-symbols/)


###  Topics & Technologies 
Toggle Menu 
  * [Accessibility](https://developer.apple.com/accessibility/)
  * [Accessories](https://developer.apple.com/accessories/)
  * [App Extension](https://developer.apple.com/app-extensions/)
  * [App Store](https://developer.apple.com/app-store/)
  * [Audio & Video](https://developer.apple.com/audio/)
  * [Augmented Reality](https://developer.apple.com/augmented-reality/)
  * [Design](https://developer.apple.com/design/)
  * [Distribution](https://developer.apple.com/distribute/)
  * [Education](https://developer.apple.com/education/)
  * [Fonts](https://developer.apple.com/fonts/)
  * [Games](https://developer.apple.com/games/)
  * [Health & Fitness](https://developer.apple.com/health-fitness/)
  * [In-App Purchase](https://developer.apple.com/in-app-purchase/)
  * [Localization](https://developer.apple.com/localization/)
  * [Maps & Location](https://developer.apple.com/maps/)
  * [Machine Learning & AI](https://developer.apple.com/machine-learning/)
  * [Open Source](https://opensource.apple.com/)
  * [Security](https://developer.apple.com/security/)
  * [Safari & Web](https://developer.apple.com/safari/)


###  Resources 
Toggle Menu 
  *   * [Documentation](https://developer.apple.com/documentation/)
  * [Tutorials](https://developer.apple.com/learn/)
  * [Downloads](https://developer.apple.com/download/)
  * [Forums](https://developer.apple.com/forums/)
  * [Videos](https://developer.apple.com/videos/)


###  Support 
Toggle Menu 
  * [Support Articles](https://developer.apple.com/support/articles/)
  * [Contact Us](https://developer.apple.com/contact/)
  * [Bug Reporting](https://developer.apple.com/bug-reporting/)
  * [System Status](https://developer.apple.com/system-status/)


###  Account 
Toggle Menu 
  * [Apple Developer](https://developer.apple.com/account/)
  * [App Store Connect](https://appstoreconnect.apple.com/)
  * [Certificates, IDs, & Profiles](https://developer.apple.com/account/ios/certificate/)
  * [Feedback Assistant](https://feedbackassistant.apple.com/)


###  Programs 
Toggle Menu 
  * [Apple Developer Program](https://developer.apple.com/programs/)
  * [Apple Developer Enterprise Program](https://developer.apple.com/programs/enterprise/)
  * [App Store Small Business Program](https://developer.apple.com/app-store/small-business-program/)
  * [MFi Program](https://mfi.apple.com/)
  * [News Partner Program](https://developer.apple.com/programs/news-partner/)
  * [Video Partner Program](https://developer.apple.com/programs/video-partner/)
  * [Security Bounty Program](https://developer.apple.com/security-bounty/)
  * [Security Research Device Program](https://developer.apple.com/programs/security-research-device/)


###  Events 
Toggle Menu 
  * [Meet with Apple](https://developer.apple.com/events/)
  * [Apple Developer Centers](https://developer.apple.com/events/developer-centers/)
  * [App Store Awards](https://developer.apple.com/app-store/app-store-awards/)
  * [Apple Design Awards](https://developer.apple.com/design/awards/)
  * [Apple Developer Academies](https://developer.apple.com/academies/)
  * [WWDC](https://developer.apple.com/wwdc/)


To submit feedback on documentation, visit [Feedback Assistant](applefeedback://new?form_identifier=developertools.fba&answers%5B%3Aarea%5D=seedADC%3Adevpubs&answers%5B%3Adoc_type_req%5D=Technology%20Documentation&answers%5B%3Adocumentation_link_req%5D=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2FCoreData%2Faccessing-data-when-the-store-changes).
Select a color scheme preference
Light
Dark
Auto
Copyright © 2025 [Apple Inc.](https://www.apple.com) All rights reserved. 
[ Terms of Use ](https://www.apple.com/legal/internet-services/terms/site.html)[ Privacy Policy ](https://www.apple.com/legal/privacy/)[ Agreements and Guidelines ](https://developer.apple.com/support/terms/)
