Source: https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises

[ Skip Navigation ](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises#app-main)
  * [Global Nav Open Menu](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises#ac-gn-menustate)[Global Nav Close Menu](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises)
  * [Apple Developer](https://developer.apple.com/)


[ Search Developer Cancel  ](https://developer.apple.com/search/)
  * [Apple Developer](https://developer.apple.com/)
  * [News](https://developer.apple.com/news/)
  * [Discover](https://developer.apple.com/discover/)
  * [Design](https://developer.apple.com/design/)
  * [Develop](https://developer.apple.com/develop/)
  * [Distribute](https://developer.apple.com/distribute/)
  * [Support](https://developer.apple.com/support/)
  * [Account](https://developer.apple.com/account/)
  * [](https://developer.apple.com/search/)


Cancel 
Only search within “Documentation”
### Quick Links
  * [Downloads](https://developer.apple.com/download/)
  * [Documentation](https://developer.apple.com/documentation/)
  * [Sample Code](https://developer.apple.com/documentation/samplecode/)
  * [Videos](https://developer.apple.com/videos/)
  * [Forums](https://developer.apple.com/forums/)

5 Quick Links
[ Documentation ](https://developer.apple.com/documentation)
[ Open Menu ](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises)
  * SwiftLanguage:  Swift  Objective-C 
Language: 
    * Swift 
    * [ Objective-C ](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises)


[](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises)
## [ AppKit  ](https://developer.apple.com/documentation/appkit)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
1 of 44 symbols inside <root>
Essentials
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
2 of 44 symbols inside <root> [Adopting Liquid Glass](https://developer.apple.com/documentation/technologyoverviews/adopting-liquid-glass)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
3 of 44 symbols inside <root> [AppKit updates](https://developer.apple.com/documentation/updates/appkit)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
4 of 44 symbols inside <root> [Protecting the User’s Privacy](https://developer.apple.com/documentation/uikit/protecting-the-user-s-privacy)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
5 of 44 symbols inside <root> [Porting your macOS apps to Apple silicon](https://developer.apple.com/documentation/apple-silicon/porting-your-macos-apps-to-apple-silicon)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
6 of 44 symbols inside <root>
App Structure
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
7 of 44 symbols inside <root> containing 26 symbols[App and Environment](https://developer.apple.com/documentation/appkit/app-and-environment)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
8 of 44 symbols inside <root> containing 26 symbols[Documents, Data, and Pasteboard](https://developer.apple.com/documentation/appkit/documents-data-and-pasteboard)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
1 of 26 symbols inside 955518975 
Documents
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
2 of 26 symbols inside 955518975 [Developing a Document-Based App](https://developer.apple.com/documentation/appkit/developing-a-document-based-app)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
3 of 26 symbols inside 955518975 containing 181 symbols[NSDocument](https://developer.apple.com/documentation/appkit/nsdocument)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
4 of 26 symbols inside 955518975 containing 57 symbols[NSDocumentController](https://developer.apple.com/documentation/appkit/nsdocumentcontroller)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
5 of 26 symbols inside 955518975 containing 9 symbols[NSPersistentDocument](https://developer.apple.com/documentation/appkit/nspersistentdocument)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
6 of 26 symbols inside 955518975 
User Preferences
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
7 of 26 symbols inside 955518975 containing 14 symbols[NSUserDefaultsController](https://developer.apple.com/documentation/appkit/nsuserdefaultscontroller)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
8 of 26 symbols inside 955518975 [NSUbiquitousKeyValueStore](https://developer.apple.com/documentation/foundation/nsubiquitouskeyvaluestore)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
9 of 26 symbols inside 955518975 
Pasteboard
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
10 of 26 symbols inside 955518975 containing 59 symbols[NSPasteboard](https://developer.apple.com/documentation/appkit/nspasteboard)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
12 of 26 symbols inside 955518975 containing 6 symbols[NSPasteboardReading](https://developer.apple.com/documentation/appkit/nspasteboardreading)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
13 of 26 symbols inside 955518975 containing 9 symbols[NSPasteboardWriting](https://developer.apple.com/documentation/appkit/nspasteboardwriting)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
13 of 26 symbols inside 955518975 containing 9 symbols[NSPasteboardWriting](https://developer.apple.com/documentation/appkit/nspasteboardwriting)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
14 of 26 symbols inside 955518975 containing 3 symbols[NSPasteboardItemDataProvider](https://developer.apple.com/documentation/appkit/nspasteboarditemdataprovider)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
S
15 of 26 symbols inside 955518975 containing 4 symbols[NSPasteboard.ContentsOptions](https://developer.apple.com/documentation/appkit/nspasteboard/contentsoptions)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
16 of 26 symbols inside 955518975 containing 4 symbols[NSPasteboardTypeOwner](https://developer.apple.com/documentation/appkit/nspasteboardtypeowner)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
17 of 26 symbols inside 955518975 
File Promises
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
18 of 26 symbols inside 955518975 [Supporting Drag and Drop Through File Promises](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
19 of 26 symbols inside 955518975 [Supporting Table View Drag and Drop Through File Promises](https://developer.apple.com/documentation/appkit/supporting-table-view-drag-and-drop-through-file-promises)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
20 of 26 symbols inside 955518975 [Supporting Collection View Drag and Drop Through File Promises](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
21 of 26 symbols inside 955518975 containing 7 symbols[NSFilePromiseProvider](https://developer.apple.com/documentation/appkit/nsfilepromiseprovider)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
22 of 26 symbols inside 955518975 containing 4 symbols[NSFilePromiseProviderDelegate](https://developer.apple.com/documentation/appkit/nsfilepromiseproviderdelegate)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
C
23 of 26 symbols inside 955518975 containing 7 symbols[NSFilePromiseReceiver](https://developer.apple.com/documentation/appkit/nsfilepromisereceiver)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
24 of 26 symbols inside 955518975 
Object Editing
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
25 of 26 symbols inside 955518975 containing 5 symbols[NSEditor](https://developer.apple.com/documentation/appkit/nseditor)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
rP
26 of 26 symbols inside 955518975 containing 3 symbols[NSEditorRegistration](https://developer.apple.com/documentation/appkit/nseditorregistration)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
9 of 44 symbols inside <root> containing 21 symbols[Cocoa Bindings](https://developer.apple.com/documentation/appkit/cocoa-bindings)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
10 of 44 symbols inside <root> containing 8 symbols[Resource Management](https://developer.apple.com/documentation/appkit/resource-management)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
11 of 44 symbols inside <root> containing 19 symbols[App Extensions](https://developer.apple.com/documentation/appkit/app-extensions)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
12 of 44 symbols inside <root>
User Interface
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
13 of 44 symbols inside <root> containing 60 symbols[Views and Controls](https://developer.apple.com/documentation/appkit/views-and-controls)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
14 of 44 symbols inside <root> containing 18 symbols[View Management](https://developer.apple.com/documentation/appkit/view-management)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
15 of 44 symbols inside <root> containing 13 symbols[View Layout](https://developer.apple.com/documentation/appkit/view-layout)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
16 of 44 symbols inside <root> containing 5 symbols[Appearance Customization](https://developer.apple.com/documentation/appkit/appearance-customization)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
17 of 44 symbols inside <root> containing 11 symbols[Animation](https://developer.apple.com/documentation/appkit/animation)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
18 of 44 symbols inside <root> containing 38 symbols[Windows, Panels, and Screens](https://developer.apple.com/documentation/appkit/windows-panels-and-screens)
To navigate the symbols, press Up Arrow, Down Arrow, Left Arrow or Right Arrow 
Collection
19 of 44 symbols inside <root> containing 10 symbols[Sound, Speech, and Haptics](https://developer.apple.com/documentation/appkit/sound-speech-and-haptics)
70 items were found. Tab back to navigate through them. 
/ 
Navigator is ready 
  * [ AppKit ](https://developer.apple.com/documentation/appkit)
  * [ Documents, Data, and Pasteboard ](https://developer.apple.com/documentation/appkit/documents-data-and-pasteboard)
  * [ Supporting Collection View Drag and Drop Through File Promises ](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises)
  *     * [ Documents, Data, and Pasteboard ](https://developer.apple.com/documentation/appkit/documents-data-and-pasteboard)
    * Supporting Collection View Drag and Drop Through File Promises 


Sample Code
# Supporting Collection View Drag and Drop Through File Promises
Share data between macOS apps during drag and drop by using an item provider.
[ Download ](https://docs-assets.developer.apple.com/published/2a60f49668a9/SupportingCollectionViewDragAndDropThroughFilePromises.zip)
macOS 10.15+Xcode 13.1+
## [Overview](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises#Overview)
A file promise is a possible future file sent by an app of a specified type. When working with drag and drop, use file promises to indicate intent for a future drag operation. The future drag operation promises the delivery of the file at drop time. This avoids loading or performing any actions on the file until the promise completes. Use the [`NSFilePromiseProvider`](https://developer.apple.com/documentation/appkit/nsfilepromiseprovider) class when creating file promises. Use the [`NSFilePromiseReceiver`](https://developer.apple.com/documentation/appkit/nsfilepromisereceiver) to receive file promises.
Implement drag and drop with an [`NSCollectionView`](https://developer.apple.com/documentation/appkit/nscollectionview) by using a dragging pasteboard. When a drag starts, you adopt the [`NSPasteboardWriting`](https://developer.apple.com/documentation/appkit/nspasteboardwriting) protocol to write data to the [`NSPasteboard`](https://developer.apple.com/documentation/appkit/nspasteboard). When a drag occurs, you determine the valid drop target. When the drag ends, you read the drag data from the `NSPasteboard`. Adopt [`NSCollectionViewDelegate`](https://developer.apple.com/documentation/appkit/nscollectionviewdelegate) to handle with these drag operations.
### [Display Files to Drag and Drop](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises#Display-Files-to-Drag-and-Drop)
This sample code project displays a list of image files from the Pictures folder found in the user’s home directory. It allows those pictures to be dragged within the collection view, to be reordered, and dragged out to be copied to other apps. Pictures are also dragged in from other apps like Finder, Mail, Safari, and Photos.
The sample shows how to support both `URL` and file promises drags when accepting images from Mail, Safari, Photos, and other apps that support drag and drop. It also demonstrates how to provide file promises to other apps.
### [Test Drag and Drop by Creating or Receiving File Promises](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises#Test-Drag-and-Drop-by-Creating-or-Receiving-File-Promises)
To see this sample in action, build and run the project, then drag an image from another app or location, such as Finder, Mail, Photos or Safari, into the app’s window. Dragging the image into the window imports it into a form the sample app can parse and consume. There are multiple ways to drag and drop image files to and from the sample app. The way a user drags a file determines how files are promised to and from the destination. If the user drags an image file from the app to the Finder, the Finder uses the `NSFilePromiseProvider` to make a copy. If the user drags a photo from Photos, the sample app uses `NSFilePromiseReceiver` to receive a copy.
Below are the various ways drag and drop can occur that will involve either a `NSFilePromiseProvider` or a `NSFilePromiseReceiver`.
Drag sent by `NSFilePromiseProvider`:
  * Drag an image out to the Finder.
  * Drag an image out to Mail.
  * Drag an image out to Photos.


Drag received by `NSFilePromiseReceiver`:
  * Drag an image in from Safari (from a website with a jpg, png, etc).
  * Drag an image in from Photos.
  * Drag multiple images in from Photos — to test receiving multiple file promises.
  * Drag in a very large photo from Photos app — to test the progress UI when receiving large photos.


In addition, a drag and drop involves just the image file’s URL, without a file promise:
  * Drag an image from Finder.
  * Drag an image from a Mail attachment.


This sample app also supports drag and drop of images from within the collection view that don’t involve a URL. In this case photos are re-ordered using the index path of the photo as the drag reference.
### [Support Image Import by Accepting File Promises](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises#Support-Image-Import-by-Accepting-File-Promises)
When setting up the collection view to support drag and drop, register drag pasteboard types to the collection view. This sample registers three pasteboard types. `NSFilePromiseReceiver` provides the first. This type allows the collection view to accept file promises that handle dragged images from apps like Safari or Photos. The second, `.fileURL`, accepts drags as file URLs. The third type is `itemDragType`, a custom pasteboard type that accepts collection view cell items to drag within the collection view.
The sample registers these pasteboard types in the view controller’s `viewDidLoad` function:
```
collectionView.registerForDraggedTypes(
    NSFilePromiseReceiver.readableDraggedTypes.map { NSPasteboard.PasteboardType($0) })


collectionView.registerForDraggedTypes([
    .fileURL, // Accept dragging of image file URLs from other apps.
    .itemDragType]) // Intra drag of row items numbers within the collection view.

```

Handle file promises before handling file URLs, because the file promise generally represents the higher-quality image and should take precedence when both types are supported. Provide a background-operation queue so the read-and-write operation doesn’t block the main thread. Until the file promise is fulfilled, this app shows a spinning indicator to give the user immediate feedback that the app is processing the drop. Continue to handle file URLs, in case the app from which the user drags the image doesn’t provide file promises.
```
func handlePromisedDrops(draggingInfo: NSDraggingInfo, toIndexPath: IndexPath) -> Bool {
    var handled = false
    if let promises = draggingInfo.draggingPasteboard.readObjects(forClasses: [NSFilePromiseReceiver.self], options: nil) {
        if !promises.isEmpty {
            // We have incoming drag items that are file promises.
            for promise in promises {
                if let promiseReceiver = promise as? NSFilePromiseReceiver {
                    // Show the progress indicator as we start receiving this promised file.
                    progressIndicator.isHidden = false
                    progressIndicator.startAnimation(self)
                    
                    // Ask your file promise receiver to fulfill on their promise.
                    promiseReceiver.receivePromisedFiles(atDestination: destinationURL, options: [:],
                                                         operationQueue: self.filePromiseQueue) { (fileURL, error) in
                        /** Finished copying the promised file.
                            Back on the main thread, insert the newly created image file into the table view.
                        */
                        OperationQueue.main.addOperation {
                            if error != nil {
                                self.reportURLError(fileURL, error: error!)
                            } else {
                                _ = self.insertURL(fileURL, toIndexPath: toIndexPath)
                            }
                            // Stop the progress indicator as you are done receiving this promised file.
                            self.progressIndicator.isHidden = true
                            self.progressIndicator.stopAnimation(self)
                        }
                    }
                }
            }
            handled = true
        }
    }
    return handled
}

```

### [Support Image Export by Providing File Promises](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises#Support-Image-Export-by-Providing-File-Promises)
To write images from the collection view, the sample app creates formats that other apps like Safari, Mail, and Finder can consume, write an `NSFilePromiseProvider` instance to the dragging pasteboard, and conform to [`NSFilePromiseProviderDelegate`](https://developer.apple.com/documentation/appkit/nsfilepromiseproviderdelegate) by implementing three delegate functions.
Use the first function to provide the title of the file to be promised. This sample uses the last component of the photo item’s `fileURL` to determine the promised file name.
```
func filePromiseProvider(_ filePromiseProvider: NSFilePromiseProvider, fileNameForType fileType: String) -> String {
    // Return the photoItem's URL file name.
    let photoItem = photoFromFilePromiserProvider(filePromiseProvider: filePromiseProvider)
    return (photoItem?.fileURL.lastPathComponent)!
}

```

Provide a background operation queue in [`operationQueue(for:)`](https://developer.apple.com/documentation/appkit/nsfilepromiseproviderdelegate/operationqueue\(for:\)), so the file write happens without blocking the app’s UI. This function is optional, but defaulting to the main queue will block the app’s UI for writing large files to disk. When possible, provide a background queue.
```
func operationQueue(for filePromiseProvider: NSFilePromiseProvider) -> OperationQueue {
    return filePromiseQueue
}

```

The third delegate function performs the actual writing of the file to disk when it is time to fulfill the file promise. Add custom logic necessary to transform the image from the app into a file format that other apps are likely to understand, such as the image formats that this sample uses.
```
func filePromiseProvider(_ filePromiseProvider: NSFilePromiseProvider,
                         writePromiseTo url: URL,
                         completionHandler: @escaping (Error?) -> Void) {
    do {
        if let photoItem = photoFromFilePromiserProvider(filePromiseProvider: filePromiseProvider) {
            /** Copy the file to the location provided to you. You always do a copy, not a move.
                It's important you call the completion handler.
            */
            try FileManager.default.copyItem(at: photoItem.fileURL, to: url)
        }
        completionHandler(nil)
    } catch let error {
        OperationQueue.main.addOperation {
            self.presentError(error, modalFor: self.view.window!,
                              delegate: nil, didPresent: nil, contextInfo: nil)
        }
        completionHandler(error)
    }
}

```

Implement `NSCollectionViewDelegate` [`collectionView(_:pasteboardWriterForItemAt:)`](https://developer.apple.com/documentation/appkit/nscollectionviewdelegate/collectionview\(_:pasteboardwriterforitemat:\)-7ldvs) so the collection view uses the file promise provider when the image files are dragged out. It returns a custom instance of [`NSFilePromiseProvider`](https://developer.apple.com/documentation/appkit/nsfilepromiseprovider) implements the `NSPasteboardWriting` protocol.
```
func collectionView(_ collectionView: NSCollectionView,
                    pasteboardWriterForItemAt indexPath: IndexPath) -> NSPasteboardWriting? {
    /** Here the sample provide a custom NSFilePromise#imageLiteral(resourceName: "_DSC9930.jpeg")#imageLiteral(resourceName: "_DSC9930.jpeg")Provider.
        Here we provide a custom provider, offering the row to the drag object, and its URL.
    */
    var provider: NSFilePromiseProvider?


    guard let photoItem =
        dataSource.itemIdentifier(for: IndexPath(item: indexPath.item, section: 0)) else { return provider }
    let photoFileExtension = photoItem.fileURL.pathExtension
    
    if #available(macOS 11.0, *) {
        let typeIdentifier = UTType(filenameExtension: photoFileExtension)
        provider = FilePromiseProvider(fileType: typeIdentifier!.identifier, delegate: self)
    } else {
        let typeIdentifier =
              UTTypeCreatePreferredIdentifierForTag(kUTTagClassFilenameExtension, photoFileExtension as CFString, nil)
        provider = FilePromiseProvider(fileType: typeIdentifier!.takeRetainedValue() as String, delegate: self)
    }
    
    // Send out the indexPath and photo's url dictionary.
    do {
        let data = try NSKeyedArchiver.archivedData(withRootObject: indexPath, requiringSecureCoding: false)
        provider!.userInfo = [FilePromiseProvider.UserInfoKeys.urlKey: photoItem.fileURL as Any,
                              FilePromiseProvider.UserInfoKeys.indexPathKey: data]
    } catch {
        fatalError("failed to archive indexPath to pasteboard")
    }
    return provider
}

```

Returning a non-nil value will make the collection view cell draggable. To drag image files from the collection view to other apps, the collection view’s drag operation mask is set by the collection view’s view controller to work outside the app using [`setDraggingSourceOperationMask(_:forLocal:)`](https://developer.apple.com/documentation/appkit/nscollectionview/setdraggingsourceoperationmask\(_:forlocal:\)).
```
collectionView.setDraggingSourceOperationMask([.copy, .delete], forLocal: false)

```

### [Validate the Collection Drop](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises#Validate-the-Collection-Drop)
To allow the collection view to determine a valid drop target, implement [`collectionView(_:validateDrop:proposedIndex:dropOperation:)`](https://developer.apple.com/documentation/appkit/nscollectionviewdelegate/collectionview\(_:validatedrop:proposedindex:dropoperation:\)). UIKit calls this delegate function when a drag is moved over the collection view and before the dragging object is dropped by the user. Specify how to respond to a proposed drop operation, which will be either on or above a cell. In this sample, users can drop items between cells to insert them.
### [Accept the Drop onto the Collection View](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises#Accept-the-Drop-onto-the-Collection-View)
To allow the collection view to accept the drop when the user releases the mouse button over it, implement this delegate function [`collectionView(_:acceptDrop:index:dropOperation:)`](https://developer.apple.com/documentation/appkit/nscollectionviewdelegate/collectionview\(_:acceptdrop:index:dropoperation:\)).
```
func collectionView(_ collectionView: NSCollectionView,
                    acceptDrop draggingInfo: NSDraggingInfo,
                    indexPath: IndexPath,
                    dropOperation: NSCollectionView.DropOperation) -> Bool {
    // Check where the dragged items are coming from.
    if let draggingSource = draggingInfo.draggingSource as? NSCollectionView, draggingSource == collectionView {
        // Drag source from your own collection view.
        // Move each dragged photo item to their new place.
        dropInternalPhotos(collectionView, draggingInfo: draggingInfo, indexPath: indexPath)
    } else {
        // The drop source is from another app (Finder, Mail, Safari, etc.) and there may be more than one file.
        // Drop each dragged image file to their new place.
        dropExternalPhotos(collectionView, draggingInfo: draggingInfo, indexPath: indexPath)
    }
    return true
}

```

This function handles the data from the dragging pasteboard after the user drops the image onto the collection view.
### [Drag and Drop to Reorder Collection Items](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises#Drag-and-Drop-to-Reorder-Collection-Items)
To reorder image files within the collection view, the sample app defines and registers a custom pasteboard type:
```
extension NSPasteboard.PasteboardType {
    static let itemDragType = NSPasteboard.PasteboardType("com.mycompany.mydragdrop")
}

```

When using that custom pasteboard type, the user then drags and drops images within the collection view to be reordered:
```
func dropInternalPhotos(_ collectionView: NSCollectionView, draggingInfo: NSDraggingInfo, indexPath: IndexPath) {
    var snapshot = self.dataSource.snapshot()


    draggingInfo.enumerateDraggingItems(
        options: NSDraggingItemEnumerationOptions.concurrent,
        for: collectionView,
        classes: [NSPasteboardItem.self],
        searchOptions: [:],
        using: {(draggingItem, idx, stop) in
            if let pasteboardItem = draggingItem.item as? NSPasteboardItem {
                do {
                    if let indexPathData = pasteboardItem.data(forType: .itemDragType), let photoIndexPath =
                        try NSKeyedUnarchiver.unarchiveTopLevelObjectWithData(indexPathData) as? IndexPath {
                            if let photoItem = self.dataSource.itemIdentifier(for: photoIndexPath) {
                                // Find out the proper indexPath drop point.
                                let toIndexPath = self.dropLocation(indexPath: indexPath)
                                
                                let dropItemLocation = snapshot.itemIdentifiers[toIndexPath.item]
                                if toIndexPath.item == 0 {
                                    // Item is being dropped at the beginning.
                                    snapshot.moveItem(photoItem, beforeItem: dropItemLocation)
                                } else {
                                    // Item is being dropped between items or at the very end.
                                    snapshot.moveItem(photoItem, afterItem: dropItemLocation)
                                }
                            }
                        }
                } catch {
                    Swift.debugPrint("failed to unarchive indexPath for dropped photo item.")
                }
            }
        })
    dataSource.apply(snapshot, animatingDifferences: true)
}

```

## [See Also](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises#see-also)
### [File Promises](https://developer.apple.com/documentation/appkit/supporting-collection-view-drag-and-drop-through-file-promises#File-Promises)
[Supporting Drag and Drop Through File Promises](https://developer.apple.com/documentation/appkit/supporting-drag-and-drop-through-file-promises)
Receive and provide file promises to support dragged app files and pasteboard operations.
[Supporting Table View Drag and Drop Through File Promises](https://developer.apple.com/documentation/appkit/supporting-table-view-drag-and-drop-through-file-promises)
Share data between macOS apps during drag and drop by using an item provider.
[`class NSFilePromiseProvider`](https://developer.apple.com/documentation/appkit/nsfilepromiseprovider)
An object that provides a promise for the pasteboard.
[`protocol NSFilePromiseProviderDelegate`](https://developer.apple.com/documentation/appkit/nsfilepromiseproviderdelegate)
A set of methods that provides the name of the promised file and writes the file to the destination directory when the file promise is fulfilled.
[`class NSFilePromiseReceiver`](https://developer.apple.com/documentation/appkit/nsfilepromisereceiver)
An object that receives a file promise from the pasteboard.
Current page is Supporting Collection View Drag and Drop Through File Promises 
[Apple](https://www.apple.com)
  1. [Developer](https://developer.apple.com/)
  2. [ Documentation ](https://developer.apple.com/documentation/)


###  Platforms 
Toggle Menu 
  * [iOS](https://developer.apple.com/ios/)
  * [iPadOS](https://developer.apple.com/ipados/)
  * [macOS](https://developer.apple.com/macos/)
  * [tvOS](https://developer.apple.com/tvos/)
  * [visionOS](https://developer.apple.com/visionos/)
  * [watchOS](https://developer.apple.com/watchos/)


###  Tools 
Toggle Menu 
  * [Swift](https://developer.apple.com/swift/)
  * [SwiftUI](https://developer.apple.com/swiftui/)
  * [Swift Playground](https://developer.apple.com/swift-playground/)
  * [TestFlight](https://developer.apple.com/testflight/)
  * [Xcode](https://developer.apple.com/xcode/)
  * [Xcode Cloud](https://developer.apple.com/xcode-cloud/)
  * [SF Symbols](https://developer.apple.com/sf-symbols/)


###  Topics & Technologies 
Toggle Menu 
  * [Accessibility](https://developer.apple.com/accessibility/)
  * [Accessories](https://developer.apple.com/accessories/)
  * [App Extension](https://developer.apple.com/app-extensions/)
  * [App Store](https://developer.apple.com/app-store/)
  * [Audio & Video](https://developer.apple.com/audio/)
  * [Augmented Reality](https://developer.apple.com/augmented-reality/)
  * [Design](https://developer.apple.com/design/)
  * [Distribution](https://developer.apple.com/distribute/)
  * [Education](https://developer.apple.com/education/)
  * [Fonts](https://developer.apple.com/fonts/)
  * [Games](https://developer.apple.com/games/)
  * [Health & Fitness](https://developer.apple.com/health-fitness/)
  * [In-App Purchase](https://developer.apple.com/in-app-purchase/)
  * [Localization](https://developer.apple.com/localization/)
  * [Maps & Location](https://developer.apple.com/maps/)
  * [Machine Learning & AI](https://developer.apple.com/machine-learning/)
  * [Open Source](https://opensource.apple.com/)
  * [Security](https://developer.apple.com/security/)
  * [Safari & Web](https://developer.apple.com/safari/)


###  Resources 
Toggle Menu 
  *   * [Documentation](https://developer.apple.com/documentation/)
  * [Tutorials](https://developer.apple.com/learn/)
  * [Downloads](https://developer.apple.com/download/)
  * [Forums](https://developer.apple.com/forums/)
  * [Videos](https://developer.apple.com/videos/)


###  Support 
Toggle Menu 
  * [Support Articles](https://developer.apple.com/support/articles/)
  * [Contact Us](https://developer.apple.com/contact/)
  * [Bug Reporting](https://developer.apple.com/bug-reporting/)
  * [System Status](https://developer.apple.com/system-status/)


###  Account 
Toggle Menu 
  * [Apple Developer](https://developer.apple.com/account/)
  * [App Store Connect](https://appstoreconnect.apple.com/)
  * [Certificates, IDs, & Profiles](https://developer.apple.com/account/ios/certificate/)
  * [Feedback Assistant](https://feedbackassistant.apple.com/)


###  Programs 
Toggle Menu 
  * [Apple Developer Program](https://developer.apple.com/programs/)
  * [Apple Developer Enterprise Program](https://developer.apple.com/programs/enterprise/)
  * [App Store Small Business Program](https://developer.apple.com/app-store/small-business-program/)
  * [MFi Program](https://mfi.apple.com/)
  * [News Partner Program](https://developer.apple.com/programs/news-partner/)
  * [Video Partner Program](https://developer.apple.com/programs/video-partner/)
  * [Security Bounty Program](https://developer.apple.com/security-bounty/)
  * [Security Research Device Program](https://developer.apple.com/programs/security-research-device/)


###  Events 
Toggle Menu 
  * [Meet with Apple](https://developer.apple.com/events/)
  * [Apple Developer Centers](https://developer.apple.com/events/developer-centers/)
  * [App Store Awards](https://developer.apple.com/app-store/app-store-awards/)
  * [Apple Design Awards](https://developer.apple.com/design/awards/)
  * [Apple Developer Academies](https://developer.apple.com/academies/)
  * [WWDC](https://developer.apple.com/wwdc/)


To submit feedback on documentation, visit [Feedback Assistant](applefeedback://new?form_identifier=developertools.fba&answers%5B%3Aarea%5D=seedADC%3Adevpubs&answers%5B%3Adoc_type_req%5D=Technology%20Documentation&answers%5B%3Adocumentation_link_req%5D=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fappkit%2Fsupporting-collection-view-drag-and-drop-through-file-promises).
Select a color scheme preference
Light
Dark
Auto
Copyright © 2025 [Apple Inc.](https://www.apple.com) All rights reserved. 
[ Terms of Use ](https://www.apple.com/legal/internet-services/terms/site.html)[ Privacy Policy ](https://www.apple.com/legal/privacy/)[ Agreements and Guidelines ](https://developer.apple.com/support/terms/)
